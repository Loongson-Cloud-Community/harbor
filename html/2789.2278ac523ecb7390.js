"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[2789],{2789:(P,v,c)=>{c.r(v),c.d(v,{AuditLogModule:()=>J});var l=c(2787),C=c(4554),D=c(4716),f=c(1691),e=c(5879),L=c(5738),y=c(3419),d=c(8280),_=c(6814),g=c(927),O=c(27),u=c(6223);let p=(()=>{var i;class s{constructor(){this.valFn=u.kI.nullValidator}ngOnChanges(n){this.valFn=n.dateValidator?i=>{let s=i.value,r=!0;if(s){const t=/^(0[1-9]|[12][0-9]|3[01])[- /.](0[1-9]|1[012])[- /.](19|20)\d\d$/g,o=/^(0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])[- /.](19|20)\d\d$/g;r=/^(19|20)\d\d([- /.])(0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])$/g.test(s)||t.test(s)||o.test(s)}return r?null:{dateValidator:{value:s}}}:u.kI.nullValidator}validate(n){return this.valFn(n)}}return(i=s).\u0275fac=function(n){return new(n||i)},i.\u0275dir=e.lG2({type:i,selectors:[["","dateValidator",""]],inputs:{dateValidator:"dateValidator"},features:[e._Bn([{provide:u.Cf,useExisting:i,multi:!0}]),e.TTD]}),s})();var m=c(9515);const E=["searchTime"];function Z(i,s){1&i&&(e.TgZ(0,"span",4),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"AUDIT_LOG.INVALID_DATE")," "))}let I=(()=>{var i;class s{constructor(){this.search=new e.vpe}ngOnChanges(){this.dateInput=this.dateInput.trim()}get dateInvalid(){return this.searchTime.errors&&this.searchTime.errors.dateValidator&&(this.searchTime.dirty||this.searchTime.touched)||!1}doSearch(){let n="";this.searchTime.valid&&this.dateInput&&(n=this.searchTime.value),this.search.emit(n)}}return(i=s).\u0275fac=function(n){return new(n||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["hbr-datetime"]],viewQuery:function(n,t){if(1&n&&e.Gf(E,7),2&n){let o;e.iGM(o=e.CRH())&&(t.searchTime=o.first)}},inputs:{dateInput:"dateInput",oneDayOffset:"oneDayOffset"},outputs:{search:"search"},features:[e._Bn([{provide:e.soG,useValue:localStorage.getItem(O.R4)}]),e.TTD],decls:4,vars:4,consts:[["aria-haspopup","true","role","tooltip",1,"tooltip","tooltip-validation","tooltip-sm"],["clrDate","","type","date","name","searchTime","placeholder","mm/dd/yyyy","dateValidator","",3,"ngModel","ngModelChange"],["searchTime","ngModel"],["class","tooltip-content",4,"ngIf"],[1,"tooltip-content"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("ngModelChange",function(a){return t.dateInput=a})("ngModelChange",function(){return t.doSearch()}),e.qZA(),e.YNc(3,Z,3,3,"span",3),e.qZA()),2&n&&(e.ekj("invalid",t.dateInvalid),e.xp6(1),e.Q6J("ngModel",t.dateInput),e.xp6(2),e.Q6J("ngIf",t.dateInvalid))},dependencies:[u.Fj,u.JJ,u.On,_.O5,d.Tsp,d.ZJg,p,m.X$],styles:[".tooltip.tooltip-validation.invalid[_ngcontent-%COMP%]:before{top:.7em;right:3em}.tooltip[_ngcontent-%COMP%] > .tooltip-content[_ngcontent-%COMP%]{opacity:1;visibility:visible;left:75%;background-color:#c92100}.tooltip[_ngcontent-%COMP%] > .tooltip-content[_ngcontent-%COMP%]:before{border-left-color:#c92100;border-top-color:#c92100}"]}),s})();var x=c(4410);function M(i,s){1&i&&e._UZ(0,"span",26)}function U(i,s){if(1&i){const r=e.EpF();e.TgZ(0,"a",23),e.NdJ("click",function(){const o=e.CHM(r).$implicit,a=e.oxw(2);return e.KtG(a.toggleFilterOption(o.key))}),e._UZ(1,"clr-icon",24),e.YNc(2,M,1,0,"ng-template",25),e._uU(3),e.ALo(4,"translate"),e.qZA()}if(2&i){const r=s.$implicit;e.xp6(1),e.Q6J("hidden",!r.checked),e.xp6(1),e.Q6J("ngIf",!r.checked),e.xp6(1),e.hij(" ",e.lcZ(4,3,r.description)," ")}}function S(i,s){if(1&i&&(e.TgZ(0,"clr-dropdown-menu",21),e.YNc(1,U,5,5,"a",22),e.qZA()),2&i){const r=e.oxw();e.Q6J("clrPosition","bottom-left"),e.xp6(1),e.Q6J("ngForOf",r.filterOptions)}}function k(i,s){if(1&i&&(e.TgZ(0,"clr-dg-row")(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e._uU(4),e.qZA(),e.TgZ(5,"clr-dg-cell"),e._uU(6),e.qZA(),e.TgZ(7,"clr-dg-cell"),e._uU(8),e.qZA(),e.TgZ(9,"clr-dg-cell"),e._uU(10),e.ALo(11,"harborDatetime"),e.qZA()()),2&i){const r=s.$implicit;e.xp6(2),e.Oqu(r.username),e.xp6(2),e.Oqu(r.resource),e.xp6(2),e.Oqu(r.resource_type),e.xp6(2),e.Oqu(r.operation),e.xp6(2),e.Oqu(e.xi3(11,5,r.op_time,"short"))}}function w(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){e.oxw();const r=e.MAs(41);e.xp6(1),e.lnq("",r.firstItem+1," - ",r.lastItem+1," ",e.lcZ(2,3,"AUDIT_LOG.OF")," ")}}const F=function(){return[15,25,50]},q={0:"AUDIT_LOG.ADVANCED",1:"AUDIT_LOG.SIMPLE"};class T{constructor(s,r,n){this.iKey=s,this.iDescription=r,this.iChecked=n,this.key=s,this.description=r,this.checked=n}toString(){return"key:"+this.key+", description:"+this.description+", checked:"+this.checked+"\n"}}class N{constructor(){this.startTime="",this.endTime=""}}const R=[{path:"",component:(()=>{var i;class s{get showPaginationIndex(){return this.totalRecordCount>0}constructor(n,t,o,a){this.route=n,this.router=t,this.auditLogService=o,this.messageHandlerService=a,this.search=new N,this.queryOperation=[],this.loading=!0,this.toggleName=q,this.currentOption=0,this.filterOptions=[new T("all","AUDIT_LOG.ALL_OPERATIONS",!0),new T("pull","AUDIT_LOG.PULL",!0),new T("create","AUDIT_LOG.CREATE",!0),new T("delete","AUDIT_LOG.DELETE",!0),new T("others","AUDIT_LOG.OTHERS",!0)],this.pageOffset=1,this.pageSize=(0,f.tb)(f.V2.PROJECT_AUDIT_LOG_COMPONENT),this.totalRecordCount=0,this.currentPage=1,this.totalPage=0,this.route.data.subscribe(A=>this.currentUser=A.auditLogResolver)}ngOnInit(){const n=this.route.parent.parent.snapshot.data;n&&(this.projectName=n.projectResolver.name)}retrieve(n){n&&n.page&&(this.pageSize=n.page.size,(0,f.Pe)(f.V2.PROJECT_AUDIT_LOG_COMPONENT,this.pageSize));const t=[];this.queryUsername&&t.push(`username=~${this.queryUsername}`),this.queryStartTime&&this.queryEndTime?t.push(`op_time=[${this.queryStartTime}~${this.queryEndTime}]`):(this.queryStartTime&&t.push(`op_time=[${this.queryStartTime}~]`),this.queryEndTime&&t.push(`op_time=[~${this.queryEndTime}]`)),this.queryOperation&&this.queryOperation.length>0&&t.push(`operation={${this.queryOperation.join(" ")}}`);const o={projectName:this.projectName,pageSize:this.pageSize,page:this.currentPage};t&&t.length>0&&(o.q=encodeURIComponent(t.join(","))),this.loading=!0,this.auditLogService.getLogsResponse(o).pipe((0,D.x)(()=>this.loading=!1)).subscribe(a=>{if(a.headers){let A=a.headers.get("x-total-count");A&&(this.totalRecordCount=Number.parseInt(A,10))}this.auditLogs=a.body},a=>{this.messageHandlerService.handleError(a)})}doSearchAuditLogs(n){this.queryUsername=n,this.retrieve()}doSearchByStartTime(n){this.queryStartTime=n,this.retrieve()}doSearchByEndTime(n){this.queryEndTime=n,this.retrieve()}doSearchByOptions(){let n=!0,t=[];for(let o of this.filterOptions)o.checked?t.push(o.key):n=!1;n&&(t=[]),this.queryOperation=t,this.retrieve()}toggleOptionalName(n){this.currentOption=1===n?0:1}toggleFilterOption(n){let t=this.filterOptions.find(o=>o.key===n);if(t.checked=!t.checked,"all"===t.key)this.filterOptions.filter(o=>o.key!==t.key).forEach(o=>o.checked=t.checked);else{t.checked||(this.filterOptions.find(a=>"all"===a.key).checked=!1);let o=!0;this.filterOptions.filter(a=>"all"!==a.key).forEach(a=>{a.checked||(o=!1)}),this.filterOptions.find(a=>"all"===a.key).checked=o}this.doSearchByOptions()}refresh(){this.retrieve()}}return(i=s).\u0275fac=function(n){return new(n||i)(e.Y36(l.gz),e.Y36(l.F0),e.Y36(L.Y),e.Y36(y.d))},i.\u0275cmp=e.Xpm({type:i,selectors:[["audit-log"]],decls:48,vars:44,consts:[[1,"row"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12","reverse-row","log-top"],[1,"row","flex-items-xs-right","option-right","display-f"],[1,"flex-xs-middle"],[1,"btn","btn-link",3,"click"],[3,"withDivider","filterPlaceholder","filterEvt"],[1,"refresh-btn",3,"click"],["shape","refresh"],[1,"row","flex-items-xs-right","row-right",3,"hidden"],["clrDropdownToggle","",1,"btn","btn-link"],["shape","caret down"],[3,"clrPosition",4,"clrIfOpen"],[3,"dateInput","search"],[3,"dateInput","oneDayOffset","search"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12","datagrid-margin-top"],[3,"clrDgLoading","clrDgRefresh"],[4,"ngFor","ngForOf"],[3,"clrDgPageSize","clrDgPage","clrDgTotalItems","clrDgPageChange"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],[3,"clrPosition"],["href","javascript:void(0)","clrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["href","javascript:void(0)","clrDropdownItem","",3,"click"],["shape","check",3,"hidden"],[3,"ngIf"],[1,"check-span"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),e.NdJ("click",function(){return t.toggleOptionalName(t.currentOption)}),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"hbr-filter",5),e.NdJ("filterEvt",function(a){return t.doSearchAuditLogs(a)}),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"span",6),e.NdJ("click",function(){return t.refresh()}),e._UZ(10,"clr-icon",7),e.qZA()()(),e.TgZ(11,"div",8)(12,"clr-dropdown")(13,"button",9),e._uU(14),e.ALo(15,"translate"),e._UZ(16,"clr-icon",10),e.qZA(),e.YNc(17,S,2,2,"clr-dropdown-menu",11),e.qZA(),e.TgZ(18,"div",3)(19,"hbr-datetime",12),e.NdJ("search",function(a){return t.doSearchByStartTime(a)}),e.qZA(),e.TgZ(20,"hbr-datetime",13),e.NdJ("search",function(a){return t.doSearchByEndTime(a)}),e.qZA()()()(),e.TgZ(21,"div",14)(22,"clr-datagrid",15),e.NdJ("clrDgRefresh",function(a){return t.retrieve(a)}),e.TgZ(23,"clr-dg-column"),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.TgZ(26,"clr-dg-column"),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"clr-dg-column"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"clr-dg-column"),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"clr-dg-column"),e._uU(36),e.ALo(37,"translate"),e.qZA(),e.YNc(38,k,12,8,"clr-dg-row",16),e.TgZ(39,"clr-dg-footer")(40,"clr-dg-pagination",17,18),e.NdJ("clrDgPageChange",function(a){return t.currentPage=a}),e.TgZ(42,"clr-dg-page-size",19),e._uU(43),e.ALo(44,"translate"),e.qZA(),e.YNc(45,w,3,5,"span",20),e._uU(46),e.ALo(47,"translate"),e.qZA()()()()()),2&n&&(e.xp6(5),e.hij(" ",e.lcZ(6,23,t.toggleName[t.currentOption])," "),e.xp6(2),e.s9C("filterPlaceholder",e.lcZ(8,25,"AUDIT_LOG.FILTER_PLACEHOLDER")),e.Q6J("withDivider",!0),e.xp6(4),e.Q6J("hidden",0===t.currentOption),e.xp6(3),e.hij(" ",e.lcZ(15,27,"AUDIT_LOG.OPERATIONS")," "),e.xp6(5),e.Q6J("dateInput",t.search.startTime),e.xp6(1),e.Q6J("dateInput",t.search.endTime)("oneDayOffset",!0),e.xp6(2),e.Q6J("clrDgLoading",t.loading),e.xp6(2),e.Oqu(e.lcZ(25,29,"AUDIT_LOG.USERNAME")),e.xp6(3),e.Oqu(e.lcZ(28,31,"AUDIT_LOG.RESOURCE")),e.xp6(3),e.Oqu(e.lcZ(31,33,"AUDIT_LOG.RESOURCE_TYPE")),e.xp6(3),e.Oqu(e.lcZ(34,35,"AUDIT_LOG.OPERATION")),e.xp6(3),e.Oqu(e.lcZ(37,37,"AUDIT_LOG.TIMESTAMP")),e.xp6(2),e.Q6J("ngForOf",t.auditLogs),e.xp6(2),e.Q6J("clrDgPageSize",t.pageSize)("clrDgPage",t.currentPage)("clrDgTotalItems",t.totalRecordCount),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(43,F)),e.xp6(1),e.Oqu(e.lcZ(44,39,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",t.showPaginationIndex),e.xp6(1),e.AsE(" ",t.totalRecordCount," ",e.lcZ(47,41,"AUDIT_LOG.ITEMS")," "))},dependencies:[d.C9t,d.fv_,d.m4W,d.dRQ,d.YYR,d.Ltv,d.Z4N,d.jND,d.KHL,d.PDs,d.Gcc,d.dml,d.Nh1,d.K8c,d.qvL,d.nqY,d.f_W,d.zwp,d.ZUS,d.lU3,_.sg,_.O5,g.z,I,m.X$,x.Z],styles:[".option-right[_ngcontent-%COMP%]{padding-right:16px}.refresh-btn[_ngcontent-%COMP%]{cursor:pointer}.refresh-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.row-right[_ngcontent-%COMP%]{padding-right:60px}.log-top[_ngcontent-%COMP%]{top:12px}.check-span[_ngcontent-%COMP%]{display:inline-block;width:16px}.display-f[_ngcontent-%COMP%]{display:flex}.reverse-row[_ngcontent-%COMP%]{display:flex;flex-direction:row-reverse;align-items:baseline}.flex-items-xs-right[_ngcontent-%COMP%]{display:flex;align-items:baseline}.flex-items-xs-right[_ngcontent-%COMP%]     clr-date-container{margin-top:0}"]}),s})()}];let J=(()=>{var i;class s{}return(i=s).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[l.Bz.forChild(R),C.m]}),s})()},927:(P,v,c)=>{c.d(v,{z:()=>_});var l=c(5879),C=c(8645),D=c(3620),f=c(6223),e=c(6814),L=c(8280);const y=["inputElement"];function d(g,O){1&g&&l._UZ(0,"span",4)}let _=(()=>{var g;class O{set filterPlaceholder(p){this.placeHolder=p}constructor(p){this.cd=p,this.placeHolder="",this.filterTerms=new C.x,this.isExpanded=!1,this.filterEvt=new l.vpe,this.openFlag=new l.vpe,this.readonly=null,this.expandMode=!1,this.withDivider=!1}ngOnInit(){this.filterTerms.pipe((0,D.b)(500)).subscribe(p=>{this.filterEvt.emit(p)})}valueChange(){this.filterTerms.next(this.currentValue&&this.currentValue.trim())}inputFocus(){this.openFlag.emit(this.isExpanded)}onClick(){this.expandMode||(this.isExpanded=!this.isExpanded,this.isExpanded&&(this.cd.detectChanges(),this.inputElement.nativeElement.focus()),this.openFlag.emit(this.isExpanded))}get isShowSearchBox(){return this.expandMode||!this.expandMode&&this.isExpanded}}return(g=O).\u0275fac=function(p){return new(p||g)(l.Y36(l.sBO))},g.\u0275cmp=l.Xpm({type:g,selectors:[["hbr-filter"]],viewQuery:function(p,h){if(1&p&&l.Gf(y,5),2&p){let m;l.iGM(m=l.CRH())&&(h.inputElement=m.first)}},inputs:{readonly:"readonly",currentValue:"currentValue",filterPlaceholder:"filterPlaceholder",expandMode:"expandMode",withDivider:"withDivider",width:"width"},outputs:{filterEvt:"filterEvt",openFlag:"openFlag"},decls:5,vars:9,consts:[["shape","search","size","20",1,"search-btn",3,"click"],["type","text","autofocus","",1,"filter-input","clr-input",3,"hidden","placeholder","ngModel","keyup","focus","ngModelChange"],["inputElement",""],["class","filter-divider",4,"ngIf"],[1,"filter-divider"]],template:function(p,h){1&p&&(l.TgZ(0,"span")(1,"clr-icon",0),l.NdJ("click",function(){return h.onClick()}),l.qZA(),l.TgZ(2,"input",1,2),l.NdJ("keyup",function(){return h.valueChange()})("focus",function(){return h.inputFocus()})("ngModelChange",function(E){return h.currentValue=E}),l.qZA(),l.YNc(4,d,1,0,"span",3),l.qZA()),2&p&&(l.xp6(1),l.ekj("filter-icon",h.isShowSearchBox),l.xp6(1),l.Udp("width",h.width,"px"),l.s9C("placeholder",h.placeHolder),l.Q6J("hidden",!h.isShowSearchBox)("ngModel",h.currentValue),l.uIk("readOnly",h.readonly),l.xp6(2),l.Q6J("ngIf",h.withDivider))},dependencies:[f.Fj,f.JJ,f.On,e.O5,L.qvL],styles:[".filter-icon[_ngcontent-%COMP%]{position:relative;right:-20px}.filter-divider[_ngcontent-%COMP%]{display:inline-block;height:16px;width:1px;padding-top:12px;padding-bottom:12px;position:relative;top:9px;margin-right:6px;margin-left:6px}.search-btn[_ngcontent-%COMP%]{cursor:pointer}.search-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.filter-input[_ngcontent-%COMP%]{padding-left:24px}"]}),O})()}}]);