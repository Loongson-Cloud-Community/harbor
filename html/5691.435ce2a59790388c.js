"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[5691],{2824:(v,C,l)=>{l.d(C,{K:()=>E});var e=l(9862),c=l(6306),d=l(7398),f=l(8504),_=l(2722),m=l(1691),g=l(5879);const U=m.S$+"/users",O=m.S$+"/users/search?",P=m.S$+"/ldap/users";let E=(()=>{var T;class M{constructor(i){this.http=i}getUserListByPaging(i,s,w){let h=new e.LE;return i&&s&&(h=h.set("page",i+"").set("page_size",s+"")),w&&(h=h.set("username",w)),this.http.get(U,(0,m.gm)(h)).pipe((0,c.K)(N=>(0,f._)(N)))}handleError(i){return(0,f._)(i)}getUsersNameList(i,s){return this.http.get(`${O}page_size=${s}&username=${i}`,m.EX).pipe((0,d.U)(w=>w),(0,c.K)(w=>this.handleError(w)))}getUsers(){return this.http.get(U).pipe((0,d.U)(i=>i,(0,c.K)(i=>this.handleError(i))))}addUser(i){return this.http.post(U,JSON.stringify(i),m.T0).pipe((0,d.U)(()=>null),(0,c.K)(s=>this.handleError(s)))}deleteUser(i){return this.http.delete(U+"/"+i,m.T0).pipe((0,d.U)(()=>null),(0,c.K)(s=>this.handleError(s)))}updateUser(i){return this.http.put(U+"/"+i.user_id,JSON.stringify(i),m.T0).pipe((0,d.U)(()=>null),(0,c.K)(s=>this.handleError(s)))}updateUserRole(i){return this.http.put(U+"/"+i.user_id+"/sysadmin",JSON.stringify(i),m.T0).pipe((0,d.U)(()=>null),(0,c.K)(s=>this.handleError(s)))}changePassword(i,s,w){return i&&s?this.http.put(U+"/"+i+"/password",{old_password:s,new_password:w},m.T0).pipe((0,d.U)(h=>h),(0,c.K)(h=>(0,f._)(h))):(0,f._)("Invalid change uid or password")}getLDAPUsers(i){return this.http.get(`${P}/search?username=${i}`,m.EX).pipe((0,d.U)(s=>(s||[]).map(h=>(0,_.Z)(h))),(0,c.K)(s=>this.handleError(s)))}importLDAPUsers(i){return this.http.post(`${P}/import`,JSON.stringify({ldap_uid_list:i}),m.T0).pipe((0,d.U)(()=>null),(0,c.K)(s=>this.handleError(s)))}}return(T=M).\u0275fac=function(i){return new(i||T)(g.LFG(e.eN))},T.\u0275prov=g.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),M})()},2722:(v,C,l)=>{l.d(C,{Z:()=>d,n:()=>e});class e{}const d=function c(f){let _=new e;return _.user_id=0,_.username=f.ldap_username,_.realname=f.ldap_realname,_.email=f.ldap_email,_}},5284:(v,C,l)=>{l.d(C,{T:()=>S});var e=l(5879),c=l(2722),d=l(3924),f=l(1575),_=l(6223),m=l(6814),g=l(8280),U=l(625),O=l(9515);const P=["newUserFrom"];function E(t,u){if(1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t){const p=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,p.usernameTooltip)," ")}}function T(t,u){1&t&&(e.TgZ(0,"clr-control-helper"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"TOOLTIP.SIGN_UP_MAIL")))}function M(t,u){if(1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t){const p=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,p.emailTooltip)," ")}}function A(t,u){1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TOOLTIP.FULL_NAME")," "))}function i(t,u){if(1&t){const p=e.EpF();e.TgZ(0,"clr-icon",26),e.NdJ("click",function(){e.CHM(p);const r=e.oxw();return e.KtG(r.showNewPwd=!r.showNewPwd)}),e.qZA()}}function s(t,u){if(1&t){const p=e.EpF();e.TgZ(0,"clr-icon",27),e.NdJ("click",function(){e.CHM(p);const r=e.oxw();return e.KtG(r.showNewPwd=!r.showNewPwd)}),e.qZA()}}function w(t,u){1&t&&(e.TgZ(0,"clr-control-helper"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"CHANGE_PWD.PASS_TIPS")))}function h(t,u){1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TOOLTIP.PASSWORD")," "))}function N(t,u){if(1&t){const p=e.EpF();e.TgZ(0,"clr-icon",26),e.NdJ("click",function(){e.CHM(p);const r=e.oxw();return e.KtG(r.showConfirmPwd=!r.showConfirmPwd)}),e.qZA()}}function F(t,u){if(1&t){const p=e.EpF();e.TgZ(0,"clr-icon",27),e.NdJ("click",function(){e.CHM(p);const r=e.oxw();return e.KtG(r.showConfirmPwd=!r.showConfirmPwd)}),e.qZA()}}function Z(t,u){1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TOOLTIP.CONFIRM_PWD")," "))}function L(t,u){1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TOOLTIP.COMMENT")," "))}let S=(()=>{var t;class u{constructor(n,r){this.session=n,this.ref=r,this.showNewPwd=!1,this.showConfirmPwd=!1,this.isSelfRegistration=!1,this.valueChange=new e.vpe,this.newUser=new c.n,this.validationStateMap={},this.mailAlreadyChecked={},this.userNameAlreadyChecked={},this.emailTooltip="TOOLTIP.EMAIL",this.usernameTooltip="TOOLTIP.USER_NAME",this.formValueChanged=!1,this.checkOnGoing={}}ngOnInit(){this.resetState()}resetState(){this.showConfirmPwd=!1,this.showNewPwd=!1,this.mailAlreadyChecked={},this.userNameAlreadyChecked={},this.emailTooltip="TOOLTIP.EMAIL",this.usernameTooltip="TOOLTIP.USER_NAME",this.formValueChanged=!1,this.checkOnGoing={username:!1,email:!1},this.validationStateMap={username:!0,email:!0,realname:!0,newPassword:!0,confirmPassword:!0,comment:!0}}isChecking(n){return!this.checkOnGoing[n]}forceRefreshView(n){this.timerHandler&&clearInterval(this.timerHandler),this.timerHandler=setInterval(()=>this.ref.markForCheck(),100),setTimeout(()=>{this.timerHandler&&(clearInterval(this.timerHandler),this.timerHandler=null)},n)}getValidationState(n){return!this.validationStateMap[n]}handleValidation(n,r){if(r){let o=this.newUserForm.controls[n];if(o&&(this.validationStateMap[n]=o.valid,o.valid&&this.formValueChanged)){if("username"===n&&""!==this.newUser.username.trim())return this.userNameAlreadyChecked[this.newUser.username.trim()]?(this.validationStateMap[n]=!this.userNameAlreadyChecked[this.newUser.username.trim()].result,void(this.validationStateMap[n]||(this.usernameTooltip="TOOLTIP.USER_EXISTING"))):(this.checkOnGoing[n]=!0,void this.session.checkUserExisting("username",this.newUser.username).subscribe(a=>{this.checkOnGoing[n]=!1,this.validationStateMap[n]=!a,a&&(this.usernameTooltip="TOOLTIP.USER_EXISTING"),this.userNameAlreadyChecked[this.newUser.username.trim()]={result:a},this.forceRefreshView(2e3)},a=>{this.checkOnGoing[n]=!1,this.validationStateMap[n]=!1,this.forceRefreshView(2e3)}));if("email"===n&&""!==this.newUser.email.trim())return this.mailAlreadyChecked[this.newUser.email.trim()]?(this.validationStateMap[n]=!this.mailAlreadyChecked[this.newUser.email.trim()].result,void(this.validationStateMap[n]||(this.emailTooltip="TOOLTIP.EMAIL_EXISTING"))):(this.checkOnGoing[n]=!0,void this.session.checkUserExisting("email",this.newUser.email).subscribe(a=>{this.checkOnGoing[n]=!1,this.validationStateMap[n]=!a,a&&(this.emailTooltip="TOOLTIP.EMAIL_EXISTING"),this.mailAlreadyChecked[this.newUser.email.trim()]={result:a},this.forceRefreshView(2e3)},a=>{this.checkOnGoing[n]=!1,this.validationStateMap[n]=!1,this.forceRefreshView(2e3)}));if("confirmPassword"===n||"newPassword"===n){let I=this.newUserForm.controls["confirmPassword"===n?"newPassword":"confirmPassword"];I&&I.valid&&(this.validationStateMap.confirmPassword=o.value===I.value)}}}else this.validationStateMap[n]=!0,"email"===n&&(this.emailTooltip="TOOLTIP.EMAIL"),"username"===n&&(this.usernameTooltip="TOOLTIP.USER_NAME")}get isValid(){let n=!0;return this.newUserForm.controls.confirmPassword&&this.newUserForm.controls.newPassword&&(n=this.newUserForm.controls.confirmPassword.value===this.newUserForm.controls.newPassword.value),this.newUserForm&&this.newUserForm.valid&&n&&this.validationStateMap.username&&this.validationStateMap.email}ngAfterViewChecked(){this.newUserFormRef!==this.newUserForm&&(this.newUserFormRef=this.newUserForm,this.newUserFormRef&&this.newUserFormRef.valueChanges.subscribe(n=>{this.formValueChanged=!0,this.valueChange.emit(!0)}))}getData(){return this.newUser}reset(){this.resetState(),this.newUserForm&&this.newUserForm.reset()}isEmpty(){return(0,d.Oc)(this.newUserForm)}}return(t=u).\u0275fac=function(n){return new(n||t)(e.Y36(f.m),e.Y36(e.sBO))},t.\u0275cmp=e.Xpm({type:t,selectors:[["new-user-form"]],viewQuery:function(n,r){if(1&n&&e.Gf(P,7),2&n){let o;e.iGM(o=e.CRH())&&(r.newUserForm=o.first)}},inputs:{isSelfRegistration:"isSelfRegistration"},outputs:{valueChange:"valueChange"},decls:65,vars:48,consts:[[1,"clr-form","clr-form-horizontal"],["newUserFrom","ngForm"],[1,"clr-form-control"],[1,"required","clr-control-label"],[1,"clr-control-container"],[1,"clr-input-wrapper"],["type","text","required","","pattern",'[^,"~#$%]+',"maxLengthExt","255","name","username","id","username","size","30",1,"clr-input",3,"ngModel","ngModelChange","input","blur"],["usernameInput","ngModel"],["shape","exclamation-circle",1,"clr-validate-icon"],[1,"spinner","spinner-inline","spinner-pos",3,"hidden"],[4,"ngIf"],["name","email","type","text","required","","email","","id","email","size","30",1,"clr-input",3,"ngModel","ngModelChange","input","blur"],["eamilInput","ngModel"],[1,"required"],["clrInput","","type","text","name","realname","required","","maxLengthExt","80","id","realname","size","30",3,"ngModel","ngModelChange","input","blur"],["fullNameInput","ngModel"],["for","newPassword",1,"clr-control-label","required"],["id","newPassword","required","","pattern","^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s).{8,128}$","name","newPassword","size","30",1,"clr-input","pwd-input",3,"type","ngModel","ngModelChange","input","blur"],["newPassInput","ngModel"],["shape","eye","class","pw-eye",3,"click",4,"ngIf"],["shape","eye-hide","class","pw-eye",3,"click",4,"ngIf"],["for","confirmPassword",1,"clr-control-label","required"],["id","confirmPassword","required","","pattern","^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s).{8,128}$","name","confirmPassword","size","30",1,"clr-input","pwd-input",3,"type","ngModel","ngModelChange","input","blur"],["confirmPassInput","ngModel"],["clrInput","","type","text","name","comment","maxLengthExt","30","id","comment","size","30",3,"ngModel","ngModelChange","input","blur"],["commentInput","ngModel"],["shape","eye",1,"pw-eye",3,"click"],["shape","eye-hide",1,"pw-eye",3,"click"]],template:function(n,r){1&n&&(e.TgZ(0,"div")(1,"form",0,1)(3,"div",2)(4,"label",3),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"div",4)(8,"div",5)(9,"input",6,7),e.NdJ("ngModelChange",function(a){return r.newUser.username=a})("input",function(){return r.handleValidation("username",!1)})("blur",function(){return r.handleValidation("username",!0)}),e.qZA(),e._UZ(11,"clr-icon",8)(12,"span",9),e.qZA(),e.YNc(13,E,3,3,"clr-control-error",10),e.qZA()(),e.TgZ(14,"div",2)(15,"label",3),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"div",4)(19,"div",5)(20,"input",11,12),e.NdJ("ngModelChange",function(a){return r.newUser.email=a})("input",function(){return r.handleValidation("email",!1)})("blur",function(){return r.handleValidation("email",!0)}),e.qZA(),e._UZ(22,"clr-icon",8)(23,"span",9),e.YNc(24,T,3,3,"clr-control-helper",10),e.YNc(25,M,3,3,"clr-control-error",10),e.qZA()()(),e.TgZ(26,"clr-input-container")(27,"label",13),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"input",14,15),e.NdJ("ngModelChange",function(a){return r.newUser.realname=a})("input",function(){return r.handleValidation("realname",!1)})("blur",function(){return r.handleValidation("realname",!0)}),e.qZA(),e.YNc(32,A,3,3,"clr-control-error",10),e.qZA(),e.TgZ(33,"div",2)(34,"label",16),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"div",4)(38,"div",5)(39,"input",17,18),e.NdJ("ngModelChange",function(a){return r.newUser.password=a})("input",function(){return r.handleValidation("newPassword",!1)})("blur",function(){return r.handleValidation("newPassword",!0)}),e.qZA(),e.YNc(41,i,1,0,"clr-icon",19),e.YNc(42,s,1,0,"clr-icon",20),e._UZ(43,"clr-icon",8),e.qZA(),e.YNc(44,w,3,3,"clr-control-helper",10),e.YNc(45,h,3,3,"clr-control-error",10),e.qZA()(),e.TgZ(46,"div",2)(47,"label",21),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.TgZ(50,"div",4)(51,"div",5)(52,"input",22,23),e.NdJ("ngModelChange",function(a){return r.confirmedPwd=a})("input",function(){return r.handleValidation("confirmPassword",!1)})("blur",function(){return r.handleValidation("confirmPassword",!0)}),e.qZA(),e.YNc(54,N,1,0,"clr-icon",19),e.YNc(55,F,1,0,"clr-icon",20),e._UZ(56,"clr-icon",8),e.qZA(),e.YNc(57,Z,3,3,"clr-control-error",10),e.qZA()(),e.TgZ(58,"clr-input-container")(59,"label"),e._uU(60),e.ALo(61,"translate"),e.qZA(),e.TgZ(62,"input",24,25),e.NdJ("ngModelChange",function(a){return r.newUser.comment=a})("input",function(){return r.handleValidation("comment",!1)})("blur",function(){return r.handleValidation("comment",!0)}),e.qZA(),e.YNc(64,L,3,3,"clr-control-error",10),e.qZA()()()),2&n&&(e.xp6(5),e.Oqu(e.lcZ(6,36,"PROFILE.USER_NAME")),e.xp6(2),e.ekj("clr-error",r.getValidationState("username")),e.xp6(2),e.Q6J("ngModel",r.newUser.username),e.xp6(3),e.Q6J("hidden",r.isChecking("username")),e.xp6(1),e.Q6J("ngIf",r.getValidationState("username")),e.xp6(3),e.Oqu(e.lcZ(17,38,"PROFILE.EMAIL")),e.xp6(2),e.ekj("clr-error",r.getValidationState("email")),e.xp6(2),e.Q6J("ngModel",r.newUser.email),e.xp6(3),e.Q6J("hidden",r.isChecking("email")),e.xp6(1),e.Q6J("ngIf",r.isSelfRegistration),e.xp6(1),e.Q6J("ngIf",r.getValidationState("email")),e.xp6(3),e.Oqu(e.lcZ(29,40,"PROFILE.FULL_NAME")),e.xp6(2),e.Q6J("ngModel",r.newUser.realname),e.xp6(2),e.Q6J("ngIf",r.getValidationState("realname")),e.xp6(3),e.Oqu(e.lcZ(36,42,"PROFILE.PASSWORD")),e.xp6(2),e.ekj("clr-error",r.getValidationState("newPassword")),e.xp6(2),e.Q6J("type",r.showNewPwd?"text":"password")("ngModel",r.newUser.password),e.xp6(2),e.Q6J("ngIf",!r.showNewPwd),e.xp6(1),e.Q6J("ngIf",r.showNewPwd),e.xp6(2),e.Q6J("ngIf",r.isSelfRegistration),e.xp6(1),e.Q6J("ngIf",r.getValidationState("newPassword")),e.xp6(3),e.Oqu(e.lcZ(49,44,"CHANGE_PWD.CONFIRM_PWD")),e.xp6(2),e.ekj("clr-error",r.getValidationState("confirmPassword")),e.xp6(2),e.Q6J("type",r.showConfirmPwd?"text":"password")("ngModel",r.confirmedPwd),e.xp6(2),e.Q6J("ngIf",!r.showConfirmPwd),e.xp6(1),e.Q6J("ngIf",r.showConfirmPwd),e.xp6(2),e.Q6J("ngIf",r.getValidationState("confirmPassword")),e.xp6(3),e.Oqu(e.lcZ(61,46,"PROFILE.COMMENT")),e.xp6(2),e.Q6J("ngModel",r.newUser.comment),e.xp6(2),e.Q6J("ngIf",r.getValidationState("comment")))},dependencies:[_._Y,_.Fj,_.JJ,_.JL,_.Q7,_.c5,_.on,_.On,_.F,m.O5,g.qvL,g.MgK,g.VqA,g.CM6,g.xRP,g.G55,U.GA,O.X$],styles:[".label-info[_ngcontent-%COMP%]{margin:-5px 0 0!important;padding:0!important}.spinner-pos[_ngcontent-%COMP%]{margin-right:0!important;top:2px}.pw-eye[_ngcontent-%COMP%]{margin-left:-24px;margin-right:8px;cursor:pointer}.pwd-input[_ngcontent-%COMP%]{padding-right:26px;width:228px}",".form-group-override[_ngcontent-%COMP%]{padding-left:170px!important}.form-group-label-override[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.sub-label-for-input[_ngcontent-%COMP%]{position:absolute;top:26px;font-size:10px;font-weight:400;line-height:12px;left:170px}.body-format[_ngcontent-%COMP%]{overflow-y:hidden}.loading-top[_ngcontent-%COMP%]{top:8px}"]}),u})()}}]);