"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[3031],{9411:(L,v,s)=>{s.d(v,{U:()=>U});var u=s(9862),A=s(3586),Q=s(2181),C=s(7398),t=s(5879),q=s(9462);let U=(()=>{var O;class T extends A.b{constructor(r,g){super(r,g)}listQuotasResponse(r){let g=this.newParams(),p=new u.WM;null!=r.sort&&(g=g.set("sort",r.sort.toString())),null!=r.referenceId&&(g=g.set("reference_id",r.referenceId.toString())),null!=r.reference&&(g=g.set("reference",r.reference.toString())),null!=r.pageSize&&(g=g.set("page_size",r.pageSize.toString())),null!=r.page&&(g=g.set("page",r.page.toString())),null!=r.XRequestId&&(p=p.set("X-Request-Id",r.XRequestId.toString()));let f=new u.aW("GET",this.rootUrl+"/quotas",null,{headers:p,params:g,responseType:"json"});return this.http.request(f).pipe((0,Q.h)(_=>_ instanceof u.Zn),(0,C.U)(_=>_))}listQuotas(r){return this.listQuotasResponse(r).pipe((0,C.U)(g=>g.body))}getQuotaResponse(r){let g=this.newParams(),p=new u.WM;null!=r.XRequestId&&(p=p.set("X-Request-Id",r.XRequestId.toString()));let f=new u.aW("GET",this.rootUrl+`/quotas/${r.id}`,null,{headers:p,params:g,responseType:"json"});return this.http.request(f).pipe((0,Q.h)(_=>_ instanceof u.Zn),(0,C.U)(_=>_))}getQuota(r){return this.getQuotaResponse(r).pipe((0,C.U)(g=>g.body))}updateQuotaResponse(r){let g=this.newParams(),p=new u.WM,m=null;m=r.hard,null!=r.XRequestId&&(p=p.set("X-Request-Id",r.XRequestId.toString()));let f=new u.aW("PUT",this.rootUrl+`/quotas/${r.id}`,m,{headers:p,params:g,responseType:"json"});return this.http.request(f).pipe((0,Q.h)(_=>_ instanceof u.Zn),(0,C.U)(_=>_))}updateQuota(r){return this.updateQuotaResponse(r).pipe((0,C.U)(g=>g.body))}}return(O=T).listQuotasPath="/quotas",O.getQuotaPath="/quotas/{id}",O.updateQuotaPath="/quotas/{id}",O.\u0275fac=function(r){return new(r||O)(t.LFG(q.p),t.LFG(u.eN))},O.\u0275prov=t.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),T})()},3031:(L,v,s)=>{s.r(v),s.d(v,{ProjectQuotasModule:()=>B});var u=s(4554),A=s(2787),Q=s(4716),C=s(5205),t=s(5879),q=s(1575),U=s(7342),O=s(3419),T=s(6814),a=s(1691),r=s(27),g=s(9315),p=s(2096),m=s(1631),f=s(927),_=s(9411),M=s(9515),Z=s(7655),b=s(5738),d=s(8280),P=s(6223),E=s(208),I=s(3997);const D=["quotaForm"];function y(l,h){1&l&&(t.TgZ(0,"clr-tooltip-content",19)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&l&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"PROJECT.QUOTA_UNLIMIT_TIP")))}function S(l,h){if(1&l&&(t.TgZ(0,"option",21),t._uU(1),t.qZA()),2&l){const o=t.oxw().$implicit;t.Q6J("value",o.UNIT),t.xp6(1),t.hij(" ",null==o?null:o.UNIT," ")}}function H(l,h){1&l&&t.YNc(0,S,2,2,"option",20),2&l&&t.Q6J("ngIf",h.index>1)}function x(l,h){if(1&l&&(t.TgZ(0,"div",22)(1,"div",23),t._UZ(2,"progress",24),t.qZA(),t.TgZ(3,"label",25),t._uU(4),t.ALo(5,"translate"),t.ALo(6,"translate"),t.ALo(7,"translate"),t.qZA()()),2&l){const o=t.oxw(),e=t.MAs(21);t.xp6(1),t.ekj("danger",o.isDangerColor(+o.quotaHardLimitValue.storageLimit,o.quotaHardLimitValue.storageUsed,o.quotaHardLimitValue.storageUnit))("warning",o.isWarningColor(+o.quotaHardLimitValue.storageLimit,o.quotaHardLimitValue.storageUsed,o.quotaHardLimitValue.storageUnit)),t.xp6(1),t.s9C("value",e.invalid||-1==+o.quotaHardLimitValue.storageLimit?0:o.quotaHardLimitValue.storageUsed),t.s9C("max",e.invalid?0:o.getByte(+o.quotaHardLimitValue.storageLimit,o.quotaHardLimitValue.storageUnit)),t.xp6(2),t.HOy(" ",-1!=+o.quotaHardLimitValue.storageLimit?o.getIntegerAndUnit(o.getByte(o.quotaHardLimitValue.storageLimit,o.quotaHardLimitValue.storageUnit),o.quotaHardLimitValue.storageUsed).partNumberUsed+o.getIntegerAndUnit(o.getByte(o.quotaHardLimitValue.storageLimit,o.quotaHardLimitValue.storageUnit),o.quotaHardLimitValue.storageUsed).partCharacterUsed:o.getSuitableUnit(o.quotaHardLimitValue.storageUsed)," ",t.lcZ(5,10,"QUOTA.OF")," ",null!=e&&e.valid?-1==+(null==o.quotaHardLimitValue?null:o.quotaHardLimitValue.storageLimit)?t.lcZ(6,12,"QUOTA.UNLIMITED"):null==o.quotaHardLimitValue?null:o.quotaHardLimitValue.storageLimit:t.lcZ(7,14,"QUOTA.INVALID_INPUT")," ",-1==+(null==o.quotaHardLimitValue?null:o.quotaHardLimitValue.storageLimit)?"":null==o.quotaHardLimitValue?null:o.quotaHardLimitValue.storageUnit," ")}}let j=(()=>{var l;class h{constructor(){this.defaultTextsObj={editQuota:"",setQuota:"",storageQuota:"",isSystemDefaultQuota:!1},this.quotaHardLimitValue={storageLimit:-1,storageUnit:""},this.quotaUnits=r.NZ,this.staticBackdrop=!0,this.closable=!1,this.confirmAction=new t.vpe,this.quotaDangerCoefficient=r.u1,this.quotaWarningCoefficient=r.HE}onSubmit(){this.confirmAction.emit({formValue:this.currentForm.value,isSystemDefaultQuota:this.defaultTextsObj.isSystemDefaultQuota,id:this.quotaHardLimitValue.id})}onCancel(){this.openEditQuota=!1}openEditQuotaModal(e){this.defaultTextsObj=e,this.quotaHardLimitValue=this.defaultTextsObj.isSystemDefaultQuota?{storageLimit:e.quotaHardLimitValue.storageLimit===r.GI?r.GI:(0,a.gv)(e.quotaHardLimitValue.storageLimit,(0,a.d9)(r.NZ),0,(0,a.d9)(r.NZ)).partNumberHard,storageUnit:e.quotaHardLimitValue.storageLimit===r.GI?r.NZ[3].UNIT:(0,a.gv)(e.quotaHardLimitValue.storageLimit,(0,a.d9)(r.NZ),0,(0,a.d9)(r.NZ)).partCharacterHard}:{storageLimit:e.quotaHardLimitValue.hard.storage===r.GI?r.GI:(0,a.gv)(e.quotaHardLimitValue.hard.storage,(0,a.d9)(r.NZ),e.quotaHardLimitValue.used.storage,(0,a.d9)(r.NZ)).partNumberHard,storageUnit:e.quotaHardLimitValue.hard.storage===r.GI?r.NZ[3].UNIT:(0,a.gv)(e.quotaHardLimitValue.hard.storage,(0,a.d9)(r.NZ),e.quotaHardLimitValue.used.storage,(0,a.d9)(r.NZ)).partCharacterHard,id:e.quotaHardLimitValue.id,storageUsed:e.quotaHardLimitValue.used.storage},this.currentForm.resetForm({storage:this.quotaHardLimitValue.storageLimit,storageUnit:this.quotaHardLimitValue.storageUnit}),this.openEditQuota=!0,this.currentForm.form.controls.storage.setValidators([P.kI.required,P.kI.pattern("(^-1$)|(^([1-9]+)([0-9]+)*$)"),(0,a.CG)(this.currentForm.form.controls.storageUnit)]),this.currentForm.form.valueChanges.pipe((0,I.x)((i,c)=>JSON.stringify(i)===JSON.stringify(c))).subscribe(i=>{["storage","storageUnit"].forEach(c=>{this.currentForm.form.get(c)&&null!==this.currentForm.form.get(c).value&&this.currentForm.form.get(c).updateValueAndValidity()})})}get isValid(){return this.currentForm.valid&&this.currentForm.dirty}getSuitableUnit(e){const n=(0,a.d9)(r.NZ);return(0,a.kU)(e,n)}getIntegerAndUnit(e,n){return(0,a.gv)(e,(0,a.d9)(r.NZ),n,(0,a.d9)(r.NZ))}getByte(e,n){return+e==+e?(0,a.J1)(+e,n):0}isDangerColor(e,n,i){return i?e!==r.GI&&+n/(0,a.J1)(+e,i)>=this.quotaDangerCoefficient:e!==r.GI&&+n/+e>=this.quotaDangerCoefficient}isWarningColor(e,n,i){return i?e!==r.GI&&+n/(0,a.J1)(+e,i)>=this.quotaWarningCoefficient&&+n/(0,a.J1)(+e,i)<=this.quotaDangerCoefficient:e!==r.GI&&+n/+e>=this.quotaWarningCoefficient&&+n/+e<=this.quotaDangerCoefficient}}return(l=h).\u0275fac=function(e){return new(e||l)},l.\u0275cmp=t.Xpm({type:l,selectors:[["edit-project-quotas"]],viewQuery:function(e,n){if(1&e&&(t.Gf(E.l,5),t.Gf(D,7)),2&e){let i;t.iGM(i=t.CRH())&&(n.inlineAlert=i.first),t.iGM(i=t.CRH())&&(n.currentForm=i.first)}},outputs:{confirmAction:"confirmAction"},decls:32,vars:24,consts:[[1,"quota-modal",3,"clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalOpenChange"],[1,"modal-title"],[1,"modal-title","p-0"],[1,"modal-body"],[1,"body-label"],[1,"clr-form","clr-form-horizontal"],["quotaForm","ngForm"],[1,"left-label","required"],["clrTooltipTrigger","","shape","info-circle","size","24"],["clrPosition","top-right","clrSize","lg",4,"clrIfOpen"],[1,"clr-select-wrapper"],["id","select-error","name","storageUnit",1,"clr-select",3,"ngModel","ngModelChange"],["ngFor","",3,"ngForOf"],["class","progress-block progress-min-width progress-div",4,"ngIf"],["clrInput","","name","storage","type","text","id","storage","size","40",1,"quota-input",3,"ngModel","ngModelChange"],["storageInput","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-outline",3,"click"],["id","edit-quota-save","type","button",1,"btn","btn-primary",3,"disabled","click"],["clrPosition","top-right","clrSize","lg"],[3,"value",4,"ngIf"],[3,"value"],[1,"progress-block","progress-min-width","progress-div"],[1,"progress","success"],["data-displayval","100%",3,"value","max"],[1,"progress-label"]],template:function(e,n){1&e&&(t.TgZ(0,"clr-modal",0),t.NdJ("clrModalOpenChange",function(c){return n.openEditQuota=c}),t.TgZ(1,"h3",1),t._uU(2),t.qZA(),t._UZ(3,"inline-alert",2),t.TgZ(4,"div",3)(5,"label",4),t._uU(6),t.qZA(),t.TgZ(7,"form",5,6)(9,"clr-input-container")(10,"label",7),t._uU(11),t.ALo(12,"translate"),t.TgZ(13,"clr-tooltip"),t._UZ(14,"clr-icon",8),t.YNc(15,y,4,3,"clr-tooltip-content",9),t.qZA(),t.TgZ(16,"div",10)(17,"select",11),t.NdJ("ngModelChange",function(c){return n.quotaHardLimitValue.storageUnit=c}),t.YNc(18,H,1,1,"ng-template",12),t.qZA()(),t.YNc(19,x,8,16,"div",13),t.qZA(),t.TgZ(20,"input",14,15),t.NdJ("ngModelChange",function(c){return n.quotaHardLimitValue.storageLimit=c}),t.qZA(),t.TgZ(22,"clr-control-error"),t._uU(23),t.ALo(24,"translate"),t.qZA()()()(),t.TgZ(25,"div",16)(26,"button",17),t.NdJ("click",function(){return n.onCancel()}),t._uU(27),t.ALo(28,"translate"),t.qZA(),t.TgZ(29,"button",18),t.NdJ("click",function(){return n.onSubmit()}),t._uU(30),t.ALo(31,"translate"),t.qZA()()()),2&e&&(t.Q6J("clrModalOpen",n.openEditQuota)("clrModalStaticBackdrop",n.staticBackdrop)("clrModalClosable",n.closable),t.xp6(2),t.Oqu(n.defaultTextsObj.editQuota),t.xp6(4),t.Oqu(n.defaultTextsObj.setQuota),t.xp6(1),t.ekj("clr-form-compact-common",!n.defaultTextsObj.isSystemDefaultQuota),t.xp6(4),t.hij("",t.lcZ(12,16,n.defaultTextsObj.storageQuota)," "),t.xp6(6),t.Q6J("ngModel",n.quotaHardLimitValue.storageUnit),t.xp6(1),t.Q6J("ngForOf",n.quotaUnits),t.xp6(1),t.Q6J("ngIf",!n.defaultTextsObj.isSystemDefaultQuota),t.xp6(1),t.Q6J("ngModel",n.quotaHardLimitValue.storageLimit),t.xp6(3),t.Oqu(t.lcZ(24,18,"PROJECT.STORAGE_QUOTA_TIP")),t.xp6(4),t.hij(" ",t.lcZ(28,20,"BUTTON.CANCEL")," "),t.xp6(2),t.Q6J("disabled",!n.isValid),t.xp6(1),t.hij(" ",t.lcZ(31,22,"BUTTON.OK")," "))},dependencies:[P._Y,P.YN,P.Kr,P.Fj,P.EJ,P.JJ,P.JL,P.On,P.F,d.qvL,d.qAN,d.VLi,d.nqY,d.MgK,d.VqA,d.xRP,d.G55,d.Jmj,d.bMv,d.zDF,T.sg,T.O5,E.l,M.X$],styles:["[_nghost-%COMP%]  .modal-dialog{width:30rem}.modal-body[_ngcontent-%COMP%]{outline:none;padding-top:.8rem;overflow-y:visible;overflow-x:visible}.modal-body[_ngcontent-%COMP%]   .body-label[_ngcontent-%COMP%]{font-size:14px}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]{padding-left:0}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .left-label[_ngcontent-%COMP%]{width:11.5rem;font-weight:100;position:relative}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .mr-3px[_ngcontent-%COMP%]{margin-right:3px}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .quota-input[_ngcontent-%COMP%]{width:2.25rem;margin-left:1rem;margin-right:.2rem}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .clr-validate-icon[_ngcontent-%COMP%]{margin-left:-.6rem}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .select-div[_ngcontent-%COMP%]{width:2.5rem}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .clr-select-wrapper[_ngcontent-%COMP%]{position:absolute;right:-8rem;top:-.11rem}.modal-body[_ngcontent-%COMP%]   .clr-form-compact-common[_ngcontent-%COMP%]   .left-label[_ngcontent-%COMP%]{width:9.5rem}.modal-body[_ngcontent-%COMP%]   .clr-form-compact-common[_ngcontent-%COMP%]   .quota-input[_ngcontent-%COMP%]{margin-left:0}.modal-body[_ngcontent-%COMP%]   .clr-form-compact-common[_ngcontent-%COMP%]   .select-div[_ngcontent-%COMP%]{width:1.6rem}.modal-body[_ngcontent-%COMP%]   .clr-form-compact-common[_ngcontent-%COMP%]   .clr-select-wrapper[_ngcontent-%COMP%]{right:-5.5rem}select[_ngcontent-%COMP%]{font-weight:100}.progress-block[_ngcontent-%COMP%]{width:8rem}.progress-div[_ngcontent-%COMP%]{position:absolute;padding-right:.6rem;width:7.5rem;top:.2rem;right:-13.3rem}.progress-label[_ngcontent-%COMP%]{position:absolute;right:-4rem;margin-top:0;width:5rem;font-weight:100;font-size:10px}  .clr-error .clr-validate-icon{margin-left:-12px}"]}),h})();const V=["editProjectQuotas"];function N(l,h){if(1&l){const o=t.EpF();t.TgZ(0,"clr-dg-row",25)(1,"clr-dg-cell")(2,"a",26),t.NdJ("click",function(){const i=t.CHM(o).$implicit,c=t.oxw();return t.KtG(c.goToLink(null==i||null==i.ref?null:i.ref.id))}),t._uU(3),t.qZA()(),t.TgZ(4,"clr-dg-cell"),t._uU(5),t.qZA(),t.TgZ(6,"clr-dg-cell")(7,"div",27)(8,"div",28),t._UZ(9,"progress",29),t.qZA(),t.TgZ(10,"label",30),t._uU(11),t.ALo(12,"translate"),t.ALo(13,"translate"),t.qZA()()()()}if(2&l){const o=h.$implicit,e=t.oxw();t.Q6J("clrDgItem",o),t.xp6(3),t.Oqu(null==o||null==o.ref?null:o.ref.name),t.xp6(2),t.Oqu(null==o||null==o.ref?null:o.ref.owner_name),t.xp6(3),t.ekj("danger",-1!==o.hard.storage&&o.used.storage/o.hard.storage>e.quotaDangerCoefficient)("warning",-1!==o.hard.storage&&o.used.storage/o.hard.storage>=e.quotaWarningCoefficient&&o.used.storage/o.hard.storage<=e.quotaDangerCoefficient),t.xp6(1),t.s9C("value",-1===o.hard.storage?0:o.used.storage),t.s9C("max",o.hard.storage),t.xp6(2),t.lnq("",-1===(null==o||null==o.hard?null:o.hard.storage)?e.getSuitableUnit(null==o||null==o.used?null:o.used.storage):e.getIntegerAndUnit(null==o||null==o.hard?null:o.hard.storage,null==o||null==o.used?null:o.used.storage).partNumberUsed+e.getIntegerAndUnit(null==o||null==o.hard?null:o.hard.storage,null==o||null==o.used?null:o.used.storage).partCharacterUsed," ",t.lcZ(12,12,"QUOTA.OF")," ",t.lcZ(13,14,-1===(null==o||null==o.hard?null:o.hard.storage)?"QUOTA.UNLIMITED":e.getIntegerAndUnit(null==o||null==o.hard?null:o.hard.storage,null==o||null==o.used?null:o.used.storage).partNumberHard+e.getIntegerAndUnit(null==o||null==o.hard?null:o.hard.storage,null==o||null==o.used?null:o.used.storage).partCharacterHard)," ")}}function w(l,h){if(1&l&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&l){t.oxw();const o=t.MAs(44);t.xp6(1),t.lnq("",o.firstItem+1," - ",o.lastItem+1," ",t.lcZ(2,3,"DESTINATION.OF"),"")}}const R=function(){return[15,25,50]};let J=(()=>{var l;class h{get allConfig(){return this.config}set allConfig(e){this.config=e,this.configChange.emit(this.config)}constructor(e,n,i,c,W,Y){this.configService=e,this.quotaService=n,this.translate=i,this.router=c,this.errorHandler=W,this.projectService=Y,this.config=new C.VK,this.loading=!0,this.configChange=new t.vpe,this.refreshAllconfig=new t.vpe,this.quotaList=[],this.currentPage=1,this.totalCount=0,this.pageSize=(0,a.tb)(a.V2.PROJECT_QUOTA_COMPONENT),this.quotaDangerCoefficient=r.u1,this.quotaWarningCoefficient=r.HE,this.selectedRow=[]}editQuota(){if(this.selectedRow&&1===this.selectedRow.length){const e=[this.translate.get("QUOTA.EDIT_PROJECT_QUOTAS"),this.translate.get("QUOTA.SET_QUOTAS",{params:this.selectedRow[0].ref.name}),this.translate.get("QUOTA.STORAGE_QUOTA")];(0,g.D)(...e).subscribe(n=>{this.editQuotaDialog.openEditQuotaModal({editQuota:n[0],setQuota:n[1],storageQuota:n[2],quotaHardLimitValue:this.selectedRow[0],isSystemDefaultQuota:!1})})}}editDefaultQuota(e){const n=[this.translate.get("QUOTA.EDIT_DEFAULT_PROJECT_QUOTAS"),this.translate.get("QUOTA.SET_DEFAULT_QUOTAS"),this.translate.get("QUOTA.STORAGE_DEFAULT_QUOTA")];(0,g.D)(...n).subscribe(i=>{this.editQuotaDialog.openEditQuotaModal({editQuota:i[0],setQuota:i[1],storageQuota:i[2],quotaHardLimitValue:e,isSystemDefaultQuota:!0})})}getChanges(){let e=(0,a.My)(this.originalConfig,this.config);return e?this.getQuotaChanges(e):null}getQuotaChanges(e){let n={};for(let i in e)"storage_per_project"===i&&(n[i]=e[i]);return n}saveConfig(e){this.allConfig.storage_per_project.value=+e.storage===r.GI?e.storage:(0,a.J1)(e.storage,e.storageUnit);let n=this.getChanges();(0,a.xb)(n)?this.translate.get("CONFIG.NO_CHANGE").subscribe(i=>{this.editQuotaDialog.inlineAlert.showInlineError(i)}):(this.loading=!0,this.configService.saveConfiguration(n).pipe((0,Q.x)(()=>{this.loading=!1,this.editQuotaDialog.openEditQuota=!1})).subscribe(i=>{this.refreshAllconfig.emit(),this.errorHandler.info("CONFIG.SAVE_SUCCESS")},i=>{this.errorHandler.error(i)}))}confirmEdit(e){e.isSystemDefaultQuota?this.saveConfig(e.formValue):this.saveCurrentQuota(e)}saveCurrentQuota(e){let i={hard:{storage:+e.formValue.storage===r.GI?+e.formValue.storage:(0,a.J1)(+e.formValue.storage,e.formValue.storageUnit)}};this.loading=!0,this.quotaService.updateQuota({id:e.id,hard:i}).subscribe(c=>{this.editQuotaDialog.openEditQuota=!1,this.getQuotaList(this.currentState),this.errorHandler.info("QUOTA.SAVE_SUCCESS")},c=>{this.editQuotaDialog.inlineAlert.showInlineError(c),this.loading=!1})}getquotaHardLimitValue(){const e=this.allConfig.storage_per_project?this.allConfig.storage_per_project.value:r.GI,n=e,i=this.getIntegerAndUnit(e,0).partCharacterHard;this.quotaHardLimitValue={storageLimit:n,storageUnit:i}}getQuotaList(e){if(!e||!e.page)return;this.pageSize=e.page.size,(0,a.Pe)(a.V2.PROJECT_QUOTA_COMPONENT,this.pageSize),this.currentState=e;let n=(0,a.wy)(e);n<=0&&(n=1),this.loading=!0,this.quotaService.listQuotasResponse({reference:"project",page:n,pageSize:this.pageSize,sort:(0,a.td)(e)}).pipe((0,Q.x)(()=>{this.loading=!1,this.selectedRow=[]})).subscribe(i=>{if(i.headers){let c=i.headers.get("X-Total-Count");c&&(this.totalCount=parseInt(c,0))}this.quotaList=i.body.filter(c=>null!==c.ref)},i=>{this.errorHandler.error(i)})}ngOnChanges(e){e&&e.allConfig&&(this.originalConfig=(0,a.d9)(this.config),this.getquotaHardLimitValue())}getSuitableUnit(e){const n=(0,a.d9)(r.NZ);return(0,a.kU)(e,n)}getIntegerAndUnit(e,n){return(0,a.gv)(e,(0,a.d9)(r.NZ),n,(0,a.d9)(r.NZ))}goToLink(e){this.router.navigate(["harbor","projects",e])}refresh(){this.filterComponent&&(this.filterComponent.currentValue=null),this.currentPage=1,this.selectedRow=[],this.getQuotaList(this.currentState)}doSearch(e){e?this.projectService.listProjects({withDetail:!1,q:encodeURIComponent(`name=${e}`)}).pipe((0,m.z)(n=>n&&n.length?this.quotaService.listQuotas({referenceId:n[0].project_id.toString()}):(0,p.of)([]))).subscribe(n=>{this.quotaList=n}):this.refresh()}}return(l=h).\u0275fac=function(e){return new(e||l)(t.Y36(U.e),t.Y36(_.U),t.Y36(M.sK),t.Y36(A.F0),t.Y36(Z.q),t.Y36(b.Y))},l.\u0275cmp=t.Xpm({type:l,selectors:[["project-quotas"]],viewQuery:function(e,n){if(1&e&&(t.Gf(V,5),t.Gf(f.z,5)),2&e){let i;t.iGM(i=t.CRH())&&(n.editQuotaDialog=i.first),t.iGM(i=t.CRH())&&(n.filterComponent=i.first)}},inputs:{allConfig:"allConfig"},outputs:{configChange:"configChange",refreshAllconfig:"refreshAllconfig"},features:[t.TTD],decls:53,vars:47,consts:[[1,"color-0","pt-19px","font-size-13"],[1,"row","label-config"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12","quota-top"],[1,"default-quota"],[1,"default-quota-text"],[1,"width-10rem"],[1,"num-count"],["id","open-edit",1,"btn","btn-link","btn-sm","default-quota-edit-button",3,"click"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12"],[3,"clrDgSelected","clrDgLoading","clrDgSelectedChange","clrDgRefresh"],[1,"clr-row"],[1,"clr-col"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],[1,"clr-row","search"],[3,"withDivider","filterPlaceholder","filterEvt"],[1,"refresh-btn",3,"click"],["shape","refresh"],[3,"clrDgSortBy"],[3,"clrDgItem",4,"ngFor","ngForOf"],[3,"clrDgPageSize","clrDgPage","clrDgTotalItems","clrDgPageChange"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],[3,"confirmAction"],["editProjectQuotas",""],[3,"clrDgItem"],["href","javascript:void(0)",3,"click"],[1,"progress-block","progress-min-width"],[1,"progress","success"],["data-displayval","100%",3,"value","max"],[1,"min-label-width"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"div",4)(6,"span",5),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"span",6),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"button",7),t.NdJ("click",function(){return n.editDefaultQuota(n.quotaHardLimitValue)}),t._uU(13),t.ALo(14,"translate"),t.qZA()()()()(),t.TgZ(15,"div",8)(16,"clr-datagrid",9),t.NdJ("clrDgSelectedChange",function(c){return n.selectedRow=c})("clrDgRefresh",function(c){return n.getQuotaList(c)}),t.TgZ(17,"clr-dg-action-bar")(18,"div",10)(19,"div",11)(20,"button",12),t.NdJ("click",function(){return n.editQuota()}),t._uU(21),t.ALo(22,"translate"),t.qZA()(),t.TgZ(23,"div",11)(24,"div",13)(25,"hbr-filter",14),t.NdJ("filterEvt",function(c){return n.doSearch(c)}),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"span",15),t.NdJ("click",function(){return n.refresh()}),t._UZ(28,"clr-icon",16),t.qZA()()()()(),t.TgZ(29,"clr-dg-column"),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"clr-dg-column"),t._uU(33),t.ALo(34,"translate"),t.qZA(),t.TgZ(35,"clr-dg-column",17),t._uU(36),t.ALo(37,"translate"),t.qZA(),t.TgZ(38,"clr-dg-placeholder"),t._uU(39),t.ALo(40,"translate"),t.qZA(),t.YNc(41,N,14,16,"clr-dg-row",18),t.TgZ(42,"clr-dg-footer")(43,"clr-dg-pagination",19,20),t.NdJ("clrDgPageChange",function(c){return n.currentPage=c}),t.TgZ(45,"clr-dg-page-size",21),t._uU(46),t.ALo(47,"translate"),t.qZA(),t.YNc(48,w,3,5,"span",22),t._uU(49),t.ALo(50,"translate"),t.qZA()()()()(),t.TgZ(51,"edit-project-quotas",23,24),t.NdJ("confirmAction",function(c){return n.confirmEdit(c)}),t.qZA()()),2&e&&(t.xp6(7),t.Oqu(t.lcZ(8,24,"QUOTA.PROJECT_QUOTA_DEFAULT_DISK")),t.xp6(3),t.AsE("",-1===(null==n.quotaHardLimitValue?null:n.quotaHardLimitValue.storageLimit)?t.lcZ(11,26,"QUOTA.UNLIMITED"):n.getIntegerAndUnit(null==n.quotaHardLimitValue?null:n.quotaHardLimitValue.storageLimit,0).partNumberHard," ",-1===(null==n.quotaHardLimitValue?null:n.quotaHardLimitValue.storageLimit)?"":null==n.quotaHardLimitValue?null:n.quotaHardLimitValue.storageUnit,""),t.xp6(3),t.hij(" ",t.lcZ(14,28,"QUOTA.EDIT")," "),t.xp6(3),t.Q6J("clrDgSelected",n.selectedRow)("clrDgLoading",n.loading),t.xp6(4),t.Q6J("disabled",!(n.selectedRow&&1===n.selectedRow.length)),t.xp6(1),t.hij(" ",t.lcZ(22,30,"QUOTA.EDIT")," "),t.xp6(4),t.s9C("filterPlaceholder",t.lcZ(26,32,"QUOTA.FILTER_PLACEHOLDER")),t.Q6J("withDivider",!0),t.xp6(5),t.Oqu(t.lcZ(31,34,"QUOTA.PROJECT")),t.xp6(3),t.Oqu(t.lcZ(34,36,"QUOTA.OWNER")),t.xp6(2),t.Q6J("clrDgSortBy","used.storage"),t.xp6(1),t.Oqu(t.lcZ(37,38,"QUOTA.STORAGE")),t.xp6(3),t.Oqu(t.lcZ(40,40,"QUOTA.PLACEHOLDER")),t.xp6(2),t.Q6J("ngForOf",n.quotaList),t.xp6(2),t.Q6J("clrDgPageSize",n.pageSize)("clrDgPage",n.currentPage)("clrDgTotalItems",n.totalCount),t.xp6(2),t.Q6J("clrPageSizeOptions",t.DdM(46,R)),t.xp6(1),t.Oqu(t.lcZ(47,42,"PAGINATION.PAGE_SIZE")),t.xp6(2),t.Q6J("ngIf",n.totalCount),t.xp6(1),t.AsE(" ",n.totalCount," ",t.lcZ(50,44,"SUMMARY.QUOTAS")," "))},dependencies:[d.C9t,d.Gwl,d.fv_,d.m4W,d.dRQ,d.YYR,d.Ltv,d.F7K,d.Z4N,d.jND,d.KHL,d.PDs,d.Gcc,d.dml,d.Nh1,d.K8c,d.qvL,d.MgK,T.sg,T.O5,f.z,j,M.X$],styles:[".default-quota[_ngcontent-%COMP%]{display:flex}.default-quota[_ngcontent-%COMP%]   .default-quota-text[_ngcontent-%COMP%]{display:flex;align-items:center;font-family:Metropolis,Avenir Next,Helvetica Neue,Arial,sans-serif}.default-quota[_ngcontent-%COMP%]   .default-quota-text[_ngcontent-%COMP%]   .width-10rem[_ngcontent-%COMP%]{width:15rem;font-size:15px}.default-quota[_ngcontent-%COMP%]   .default-quota-text[_ngcontent-%COMP%]   .num-count[_ngcontent-%COMP%]{display:inline-block;min-width:2rem;font-weight:600;font-size:15px;text-transform:uppercase}.pt-19px[_ngcontent-%COMP%]{padding-top:19px}.font-size-13[_ngcontent-%COMP%]{font-size:13px}.progress-block[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:400!important;width:30%;font-size:10px}.default-quota-edit-button[_ngcontent-%COMP%]{font-size:14px;margin-left:60px}.min-label-width[_ngcontent-%COMP%]{min-width:120px}.quota-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;line-height:1.55;margin-bottom:.35rem}[_nghost-%COMP%]  .progress.warning>progress{color:orange}[_nghost-%COMP%]  .progress.warning>progress::-webkit-progress-value{background-color:orange}[_nghost-%COMP%]  .progress.warning>progress::-moz-progress-bar{background-color:orange}[_nghost-%COMP%]  .progress>progress{height:75%}.action-head-pos[_ngcontent-%COMP%]{padding-right:18px;height:100%;display:flex;justify-content:flex-end;align-items:center}.search[_ngcontent-%COMP%]{align-items:baseline;padding-top:.2rem;justify-content:flex-end;margin-right:2rem}[_nghost-%COMP%]  .filter-input{width:240px}"]}),h})();function G(l,h){if(1&l){const o=t.EpF();t.TgZ(0,"project-quotas",3),t.NdJ("refreshAllconfig",function(){t.CHM(o);const n=t.oxw();return t.KtG(n.refreshAllconfig())}),t.qZA()}if(2&l){const o=t.oxw();t.Q6J("allConfig",o.allConfig)}}const z=[{path:"",component:(()=>{var l;class h{constructor(e,n,i){this.session=e,this.configService=n,this.msgHandler=i,this.allConfig=new C.VK,this.loading=!1}ngOnInit(){let e=this.session.getCurrentUser();e&&e.has_admin_role&&this.retrieveConfig()}refreshAllconfig(){this.retrieveConfig()}retrieveConfig(){this.loading=!0,this.configService.getConfiguration().pipe((0,Q.x)(()=>this.loading=!1)).subscribe(e=>{this.allConfig=e},e=>{this.msgHandler.handleError(e)})}}return(l=h).\u0275fac=function(e){return new(e||l)(t.Y36(q.m),t.Y36(U.e),t.Y36(O.d))},l.\u0275cmp=t.Xpm({type:l,selectors:[["app-project-quotas"]],decls:5,vars:5,consts:[["sub-header-title","",1,"custom-h2"],[1,"spinner","spinner-inline","ml-1","v-mid",3,"hidden"],[3,"allConfig","refreshAllconfig",4,"ngIf"],[3,"allConfig","refreshAllconfig"]],template:function(e,n){1&e&&(t.TgZ(0,"h2",0),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"span",1),t.qZA(),t.YNc(4,G,1,1,"project-quotas",2)),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,3,"CONFIG.PROJECT_QUOTAS"),""),t.xp6(2),t.Q6J("hidden",!n.loading),t.xp6(1),t.Q6J("ngIf",!n.loading))},dependencies:[T.O5,J,M.X$],styles:[".v-mid[_ngcontent-%COMP%]{vertical-align:middle}"]}),h})()}];let B=(()=>{var l;class h{}return(l=h).\u0275fac=function(e){return new(e||l)},l.\u0275mod=t.oAB({type:l}),l.\u0275inj=t.cJS({imports:[u.m,A.Bz.forChild(z)]}),h})()},927:(L,v,s)=>{s.d(v,{z:()=>T});var u=s(5879),A=s(8645),Q=s(3620),C=s(6223),t=s(6814),q=s(8280);const U=["inputElement"];function O(a,r){1&a&&u._UZ(0,"span",4)}let T=(()=>{var a;class r{set filterPlaceholder(p){this.placeHolder=p}constructor(p){this.cd=p,this.placeHolder="",this.filterTerms=new A.x,this.isExpanded=!1,this.filterEvt=new u.vpe,this.openFlag=new u.vpe,this.readonly=null,this.expandMode=!1,this.withDivider=!1}ngOnInit(){this.filterTerms.pipe((0,Q.b)(500)).subscribe(p=>{this.filterEvt.emit(p)})}valueChange(){this.filterTerms.next(this.currentValue&&this.currentValue.trim())}inputFocus(){this.openFlag.emit(this.isExpanded)}onClick(){this.expandMode||(this.isExpanded=!this.isExpanded,this.isExpanded&&(this.cd.detectChanges(),this.inputElement.nativeElement.focus()),this.openFlag.emit(this.isExpanded))}get isShowSearchBox(){return this.expandMode||!this.expandMode&&this.isExpanded}}return(a=r).\u0275fac=function(p){return new(p||a)(u.Y36(u.sBO))},a.\u0275cmp=u.Xpm({type:a,selectors:[["hbr-filter"]],viewQuery:function(p,m){if(1&p&&u.Gf(U,5),2&p){let f;u.iGM(f=u.CRH())&&(m.inputElement=f.first)}},inputs:{readonly:"readonly",currentValue:"currentValue",filterPlaceholder:"filterPlaceholder",expandMode:"expandMode",withDivider:"withDivider",width:"width"},outputs:{filterEvt:"filterEvt",openFlag:"openFlag"},decls:5,vars:9,consts:[["shape","search","size","20",1,"search-btn",3,"click"],["type","text","autofocus","",1,"filter-input","clr-input",3,"hidden","placeholder","ngModel","keyup","focus","ngModelChange"],["inputElement",""],["class","filter-divider",4,"ngIf"],[1,"filter-divider"]],template:function(p,m){1&p&&(u.TgZ(0,"span")(1,"clr-icon",0),u.NdJ("click",function(){return m.onClick()}),u.qZA(),u.TgZ(2,"input",1,2),u.NdJ("keyup",function(){return m.valueChange()})("focus",function(){return m.inputFocus()})("ngModelChange",function(_){return m.currentValue=_}),u.qZA(),u.YNc(4,O,1,0,"span",3),u.qZA()),2&p&&(u.xp6(1),u.ekj("filter-icon",m.isShowSearchBox),u.xp6(1),u.Udp("width",m.width,"px"),u.s9C("placeholder",m.placeHolder),u.Q6J("hidden",!m.isShowSearchBox)("ngModel",m.currentValue),u.uIk("readOnly",m.readonly),u.xp6(2),u.Q6J("ngIf",m.withDivider))},dependencies:[C.Fj,C.JJ,C.On,t.O5,q.qvL],styles:[".filter-icon[_ngcontent-%COMP%]{position:relative;right:-20px}.filter-divider[_ngcontent-%COMP%]{display:inline-block;height:16px;width:1px;padding-top:12px;padding-bottom:12px;position:relative;top:9px;margin-right:6px;margin-left:6px}.search-btn[_ngcontent-%COMP%]{cursor:pointer}.search-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.filter-input[_ngcontent-%COMP%]{padding-left:24px}"]}),r})()}}]);