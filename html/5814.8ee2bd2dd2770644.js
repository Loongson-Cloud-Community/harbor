"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[5814],{5814:(nt,x,c)=>{c.r(x),c.d(x,{TagFeatureIntegrationModule:()=>et});var g=c(2141),w=c(9315),e=c(5879),_=c(2787),T=c(9515);let P=(()=>{var r;class i{constructor(t,n){this.userPermissionService=t,this.route=n}ngOnInit(){this.projectId=this.route.snapshot.parent.parent.params.id;const t=[];t.push(this.userPermissionService.getPermission(this.projectId,g._W.TAG_RETENTION.KEY,g._W.TAG_RETENTION.VALUE.READ)),t.push(this.userPermissionService.getPermission(this.projectId,g._W.IMMUTABLE_TAG.KEY,g._W.IMMUTABLE_TAG.VALUE.LIST)),(0,w.D)(t).subscribe(n=>{[this.hasTagRetentionPermission,this.hasTagImmutablePermission]=n})}}return(r=i).\u0275fac=function(t){return new(t||r)(e.Y36(g.Hx),e.Y36(_.gz))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-tag-feature-integration"]],decls:8,vars:8,consts:[[1,"btn-group","btn-tag-integration"],["routerLink","tag-retention","routerLinkActive","btn-primary","id","btn-retention",1,"btn",3,"disabled"],["routerLink","immutable-tag","routerLinkActive","btn-primary","id","btn-immutable",1,"btn",3,"disabled"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"button",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",2),e._uU(5),e.ALo(6,"translate"),e.qZA()(),e._UZ(7,"router-outlet")),2&t&&(e.xp6(1),e.Q6J("disabled",!n.hasTagRetentionPermission),e.xp6(1),e.hij(" ",e.lcZ(3,4,"TAG_RETENTION.TAG_RETENTION")," "),e.xp6(2),e.Q6J("disabled",!n.hasTagImmutablePermission),e.xp6(1),e.hij(" ",e.lcZ(6,6,"PROJECT_DETAIL.IMMUTABLE_TAG")," "))},dependencies:[_.lC,_.rH,_.Od,T.X$],styles:[".btn-tag-integration[_ngcontent-%COMP%]{margin-top:1.5rem;margin-bottom:1rem}"]}),i})();class D{constructor(){this.algorithm="or"}}class Q extends D{constructor(){super(),this.rules=[],this.trigger={kind:"Schedule",references:{},settings:{cron:""}}}}class N{constructor(){this.disabled=!1,this.action="retain",this.scope_selectors={repository:[{kind:"doublestar",decoration:"repoMatches",pattern:"**"}]},this.tag_selectors=[{kind:"doublestar",decoration:"matches",pattern:"**"}]}}class b extends N{constructor(i){super(),this.project_id=i,this.priority=0,this.action="immutable",this.template="immutable_template"}}class L extends N{constructor(){super(),this.params={},this.tag_selectors[0].extras=JSON.stringify({untagged:!0})}}class M{constructor(){this.templates=[],this.scope_selectors=[{display_text:null,kind:null,decorations:[]}],this.tag_selectors=[{display_text:null,kind:null,decorations:[]},{display_text:null,kind:null,decorations:[]}]}}const U="Running",v="Pending";var y=function(r){return r.STOP="stop",r}(y||{}),m=c(4716),u=c(1691);let f=(()=>{var r;class i{constructor(){this.I18nMap={retain:"ACTION_RETAIN",lastXDays:"RULE_NAME_1",latestActiveK:"RULE_NAME_2",latestPushedK:"RULE_NAME_3",latestPulledN:"RULE_NAME_4",always:"RULE_NAME_5",nDaysSinceLastPull:"RULE_NAME_6",nDaysSinceLastPush:"RULE_NAME_7","the artifacts from the last # days":"RULE_TEMPLATE_1","the most recent active # artifacts":"RULE_TEMPLATE_2","the most recently pushed # artifacts":"RULE_TEMPLATE_3","the most recently pulled # artifacts":"RULE_TEMPLATE_4","pulled within the last # days":"RULE_TEMPLATE_6","pushed within the last # days":"RULE_TEMPLATE_7",repoMatches:"MAT",repoExcludes:"EXC",matches:"MAT",excludes:"EXC",withLabels:"WITH",withoutLabels:"WITHOUT",COUNT:"UNIT_COUNT",DAYS:"UNIT_DAY",none:"NONE",nothing:"NONE","Parameters nDaysSinceLastPull is too large":"DAYS_LARGE","Parameters nDaysSinceLastPush is too large":"DAYS_LARGE","Parameters latestPushedK is too large":"COUNT_LARGE","Parameters latestPulledN is too large":"COUNT_LARGE"}}getI18nKey(t){return this.I18nMap[t.trim()]?"TAG_RETENTION."+this.I18nMap[t.trim()]:t}seeLog(t,n,o){window.open(`${u.S$}/retentions/${t}/executions/${n}/tasks/${o}`,"_blank")}}return(r=i).\u0275fac=function(t){return new(t||r)},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac}),i})();var Z=c(1805),C=c(7655),q=c(5738);const j=["cronScheduleComponent"],Y=["addRule"];function K(r,i){1&r&&(e.TgZ(0,"span",48),e._uU(1,"Loading..."),e.qZA())}function B(r,i){if(1&r){const l=e.EpF();e.TgZ(0,"button",58),e.NdJ("click",function(){e.CHM(l);const n=e.oxw().index,o=e.oxw(2);return e.KtG(o.toggleDisable(n,!0))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TAG_RETENTION.DISABLE")," "))}function H(r,i){if(1&r){const l=e.EpF();e.TgZ(0,"button",58),e.NdJ("click",function(){e.CHM(l);const n=e.oxw().index,o=e.oxw(2);return e.KtG(o.toggleDisable(n,!1))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TAG_RETENTION.ENABLE")," "))}function F(r,i){1&r&&e._UZ(0,"clr-icon",62)}function z(r,i){1&r&&e._UZ(0,"clr-icon",63)}function $(r,i){if(1&r&&(e.ynx(0),e.TgZ(1,"span",44),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"span"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"span"),e._uU(11),e.qZA(),e.BQk()),2&r){const l=e.oxw().$implicit,t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,4,"TAG_RETENTION.AND")),e.xp6(3),e.Oqu(e.lcZ(6,6,"TAG_RETENTION.LOWER_LABELS")),e.xp6(3),e.Oqu(e.lcZ(9,8,t.getI18nKey(null==l||null==l.tag_selectors[1]?null:l.tag_selectors[1].decoration))),e.xp6(3),e.Oqu(null==l||null==l.tag_selectors[1]?null:l.tag_selectors[1].pattern)}}const W=function(r){return{open:r}},X=function(r){return{number:r}};function V(r,i){if(1&r){const l=e.EpF();e.TgZ(0,"li",51)(1,"div",52)(2,"div",8)(3,"div",53)(4,"button",54),e.NdJ("click",function(){const o=e.CHM(l).index,s=e.oxw(2);return e.KtG(s.openEditor(o))}),e._uU(5),e.ALo(6,"translate"),e._UZ(7,"clr-icon",55),e.qZA(),e.TgZ(8,"div",56),e.YNc(9,B,3,3,"button",57),e.YNc(10,H,3,3,"button",57),e.TgZ(11,"button",58),e.NdJ("click",function(){const o=e.CHM(l).index,s=e.oxw(2);return e.KtG(s.editRuleByIndex(o))}),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"button",58),e.NdJ("click",function(){const o=e.CHM(l).index,s=e.oxw(2);return e.KtG(s.deleteRule(o))}),e._uU(15),e.ALo(16,"translate"),e.qZA()()()(),e.TgZ(17,"div",1)(18,"span"),e.YNc(19,F,1,0,"clr-icon",59),e.YNc(20,z,1,0,"clr-icon",60),e.qZA(),e.TgZ(21,"span",61)(22,"span"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"span"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"span"),e._uU(29),e.qZA(),e.TgZ(30,"span"),e._uU(31,","),e.qZA(),e.TgZ(32,"span"),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"span"),e._uU(36),e.ALo(37,"translate"),e.qZA(),e.TgZ(38,"span",44),e._uU(39),e.ALo(40,"translate"),e.qZA(),e.TgZ(41,"span"),e._uU(42),e.ALo(43,"translate"),e.qZA(),e.TgZ(44,"span"),e._uU(45),e.ALo(46,"translate"),e.qZA(),e.TgZ(47,"span"),e._uU(48),e.qZA(),e.TgZ(49,"span",44),e._uU(50),e.ALo(51,"translate"),e.qZA(),e.TgZ(52,"span"),e._uU(53),e.ALo(54,"translate"),e.qZA(),e.YNc(55,$,12,10,"ng-container",14),e.qZA()()()()}if(2&r){const l=i.$implicit,t=i.index,n=e.oxw(2);e.xp6(3),e.Q6J("ngClass",e.VKq(45,W,n.ruleIndex===t)),e.xp6(2),e.hij(" ",e.lcZ(6,20,"TAG_RETENTION.ACTION")," "),e.xp6(4),e.Q6J("ngIf",!(null!=l&&l.disabled)),e.xp6(1),e.Q6J("ngIf",null==l?null:l.disabled),e.xp6(2),e.hij(" ",e.lcZ(13,22,"TAG_RETENTION.EDIT")," "),e.xp6(3),e.hij(" ",e.lcZ(16,24,"TAG_RETENTION.DELETE")," "),e.xp6(4),e.Q6J("ngIf",!(null!=l&&l.disabled)),e.xp6(1),e.Q6J("ngIf",null==l?null:l.disabled),e.xp6(3),e.Oqu(e.lcZ(24,26,"TAG_RETENTION.IN_REPOSITORIES")),e.xp6(3),e.Oqu(e.lcZ(27,28,n.getI18nKey(null==l||null==l.scope_selectors||null==l.scope_selectors.repository[0]?null:l.scope_selectors.repository[0].decoration))),e.xp6(3),e.Oqu(n.formatPattern(null==l||null==l.scope_selectors||null==l.scope_selectors.repository[0]?null:l.scope_selectors.repository[0].pattern)),e.xp6(4),e.Oqu(e.lcZ(34,30,n.getI18nKey(null==l?null:l.action))),e.xp6(3),e.Oqu(e.xi3(37,32,n.getI18nKey(null==l?null:l.template),e.VKq(47,X,null==l?null:l.params[null==l?null:l.template]))),e.xp6(3),e.Oqu(e.lcZ(40,35,"TAG_RETENTION.WITH_CONDITION")),e.xp6(3),e.Oqu(e.lcZ(43,37,"TAG_RETENTION.LOWER_TAGS")),e.xp6(3),e.Oqu(e.lcZ(46,39,n.getI18nKey(null==l||null==l.tag_selectors[0]?null:l.tag_selectors[0].decoration))),e.xp6(3),e.Oqu(n.formatPattern(null==l||null==l.tag_selectors[0]?null:l.tag_selectors[0].pattern)),e.xp6(2),e.Oqu(n.showUntagged(null==l||null==l.tag_selectors[0]?null:l.tag_selectors[0].extras)?e.lcZ(51,41,"TAG_RETENTION.WITH_CONDITION"):""),e.xp6(3),e.Oqu(n.showUntagged(null==l||null==l.tag_selectors[0]?null:l.tag_selectors[0].extras)?e.lcZ(54,43,"TAG_RETENTION.UNTAGGED"):""),e.xp6(2),e.Q6J("ngIf",(null==l||null==l.tag_selectors[1]?null:l.tag_selectors[1].pattern)&&(null==l||null==l.tag_selectors[1]?null:l.tag_selectors[1].pattern))}}function ee(r,i){if(1&r&&(e.TgZ(0,"ul",49),e.YNc(1,V,56,49,"li",50),e.qZA()),2&r){const l=e.oxw();e.xp6(1),e.Q6J("ngForOf",null==l.retention?null:l.retention.rules)}}function te(r,i){if(1&r&&(e.ynx(0),e.TgZ(1,"span",64),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.ALo(6,"harborDatetime"),e.qZA(),e.BQk()),2&r){const l=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,2,"CLEARANCES.NEXT_SCHEDULED_TIME")),e.xp6(3),e.Oqu(e.lcZ(6,4,null==l.retention||null==l.retention.trigger||null==l.retention.trigger.settings?null:l.retention.trigger.settings.next_scheduled_time))}}function ne(r,i){if(1&r&&e._UZ(0,"app-tag-retention-tasks",67),2&r){const l=e.oxw().$implicit,t=e.oxw();e.Q6J("executionId",l.id)("retentionId",t.retentionId)}}function le(r,i){if(1&r&&(e.TgZ(0,"clr-dg-row",65)(1,"clr-dg-cell")(2,"span"),e._uU(3),e.qZA()(),e.TgZ(4,"clr-dg-cell"),e._uU(5),e.qZA(),e.TgZ(6,"clr-dg-cell"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"clr-dg-cell"),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"clr-dg-cell"),e._uU(13),e.ALo(14,"harborDatetime"),e.qZA(),e.TgZ(15,"clr-dg-cell"),e._uU(16),e.qZA(),e.YNc(17,ne,1,2,"app-tag-retention-tasks",66),e.qZA()),2&r){const l=i.$implicit;e.Q6J("clrDgItem",l),e.xp6(3),e.Oqu(l.id),e.xp6(2),e.Oqu(l.status),e.xp6(2),e.Oqu(e.lcZ(8,7,l.dry_run?"TAG_RETENTION.YES":"TAG_RETENTION.NO")),e.xp6(3),e.Oqu(e.lcZ(11,9,null!=l&&l.trigger?"SCHEDULE."+(null==l?null:l.trigger.toUpperCase()):"")),e.xp6(3),e.Oqu(e.xi3(14,11,l.start_time,"medium")),e.xp6(3),e.Oqu(l.duration)}}function re(r,i){if(1&r&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){e.oxw();const l=e.MAs(68);e.xp6(1),e.lnq("",(null==l?null:l.firstItem)+1," - ",(null==l?null:l.lastItem)+1," ",e.lcZ(2,3,"ROBOT_ACCOUNT.OF")," ")}}function oe(r,i){if(1&r){const l=e.EpF();e.TgZ(0,"div",68),e.NdJ("click",function(){e.CHM(l);const n=e.oxw();return e.KtG(n.ruleIndex=-1)}),e.qZA()}}const ie=function(r){return{"pt-1":r}},se=function(){return[15,25,50]};let E=(()=>{var r;class i{constructor(t,n,o,s,h){this.route=t,this.tagRetentionService=n,this.retentionService=o,this.errorHandler=s,this.projectService=h,this.isRetentionRunOpened=!1,this.isAbortedOpened=!1,this.isConfirmOpened=!1,this.selectedItem=null,this.ruleIndex=-1,this.retention=new Q,this.executionList=[],this.loadingExecutions=!0,this.label="TAG_RETENTION.TRIGGER",this.loadingRule=!1,this.currentPage=1,this.pageSize=(0,u.tb)(u.V2.TAG_RETENTION_COMPONENT),this.totalCount=0}originCron(){let t={type:"None",cron:""};return t.cron=this.retention.trigger.settings.cron,t.type=""===t.cron?"None":"0 0 * * * *"===t.cron?"Hourly":"0 0 0 * * *"===t.cron?"Daily":"0 0 0 * * 0"===t.cron?"Weekly":"Custom",t}ngOnInit(){this.projectId=+this.route.snapshot.parent.parent.parent.params.id,this.retention.scope={level:"project",ref:this.projectId},this.refreshAfterCreatRetention(),this.getMetadata()}ngOnDestroy(){this.executionTimeout&&(clearTimeout(this.executionTimeout),this.executionTimeout=null)}openConfirm(t){t?(this.isConfirmOpened=!0,this.cron=t):this.updateCron(t)}closeConfirm(){this.isConfirmOpened=!1,this.updateCron(this.cron)}updateCron(t){let n=(0,u.d9)(this.retention);n.trigger.settings.cron=t,n?.trigger?.settings.next_scheduled_time&&delete n?.trigger?.settings.next_scheduled_time,this.retentionId?this.retentionService.updateRetention({id:this.retentionId,policy:n}).subscribe({next:o=>{this.cronScheduleComponent.isEditMode=!1,this.getRetention()},error:o=>{this.errorHandler.error(o)}}):this.retentionService.createRetention({policy:n}).subscribe({next:o=>{this.cronScheduleComponent.isEditMode=!1,this.refreshAfterCreatRetention()},error:o=>{this.errorHandler.error(o)}})}getMetadata(){this.retentionService.getRentenitionMetadata().subscribe({next:t=>{this.addRuleComponent.metadata=t},error:t=>{this.errorHandler.error(t)}})}getRetention(){this.retentionId&&this.retentionService.getRetention({id:this.retentionId}).subscribe({next:t=>{t?.rules?.length&&t.rules.forEach(n=>{n.params||(n.params={}),this.setRuleUntagged(n)}),this.retention=t,this.loadingRule=!1},error:t=>{this.errorHandler.error(t),this.loadingRule=!1}})}editRuleByIndex(t){this.editIndex=t,this.addRuleComponent.rule=(0,u.d9)(this.retention.rules[t]),this.addRuleComponent.editRuleOrigin=(0,u.d9)(this.retention.rules[t]),this.addRuleComponent.open(),this.addRuleComponent.isAdd=!1,this.ruleIndex=-1}toggleDisable(t,n){let o=(0,u.d9)(this.retention);o.rules[t].disabled=n,this.ruleIndex=-1,this.loadingRule=!0,this.retentionService.updateRetention({id:this.retentionId,policy:o}).subscribe({next:s=>{this.getRetention()},error:s=>{this.loadingRule=!1,this.errorHandler.error(s)}})}deleteRule(t){let n=(0,u.d9)(this.retention);n.rules.splice(t,1),n.rules&&0===n.rules.length&&(n.trigger.settings.cron=""),this.ruleIndex=-1,this.loadingRule=!0,this.retentionService.updateRetention({id:this.retentionId,policy:n}).subscribe({next:o=>{this.getRetention()},error:o=>{this.loadingRule=!1,this.errorHandler.error(o)}})}setRuleUntagged(t){if(t.tag_selectors[0].extras){let n=JSON.parse(t.tag_selectors[0].extras);void 0===n.untagged&&("matches"===t.tag_selectors[0].decoration&&(n.untagged=!0),"excludes"===t.tag_selectors[0].decoration&&(n.untagged=!1),t.tag_selectors[0].extras=JSON.stringify(n))}else"matches"===t.tag_selectors[0].decoration&&(t.tag_selectors[0].extras=JSON.stringify({untagged:!0})),"excludes"===t.tag_selectors[0].decoration&&(t.tag_selectors[0].extras=JSON.stringify({untagged:!1}))}openAddRule(){this.addRuleComponent.open(),this.addRuleComponent.isAdd=!0,this.addRuleComponent.rule=new L}runRetention(){this.isRetentionRunOpened=!1,this.retentionService.triggerRetentionExecution({id:this.retentionId,body:{dry_run:!1}}).subscribe({next:t=>{this.refreshList()},error:t=>{this.errorHandler.error(t)}})}whatIfRun(){this.retentionService.triggerRetentionExecution({id:this.retentionId,body:{dry_run:!0}}).subscribe({next:t=>{this.refreshList()},error:t=>{this.errorHandler.error(t)}})}loopGettingExecutions(){this.executionList&&this.executionList.length&&this.executionList.some(t=>t.status===U||t.status===v)&&(this.executionTimeout=setTimeout(()=>{this.retentionService.listRetentionExecutionsResponse({id:this.retentionId,page:this.currentPage,pageSize:this.pageSize}).pipe((0,m.x)(()=>this.loadingExecutions=!1)).subscribe(t=>{if(t.headers){let n=t.headers.get("x-total-count");n&&(this.totalCount=parseInt(n,0))}t?.body?.length&&t.body.forEach(n=>{this.executionList.forEach(o=>{o.id===n.id&&(o.status=n.status,o.end_time=n.end_time)})}),i.calculateDuration(this.executionList),this.loopGettingExecutions()})},5e3))}refreshList(t){this.selectedItem=null,this.retentionId?(t&&t.page&&(this.pageSize=t.page.size,(0,u.Pe)(u.V2.TAG_RETENTION_COMPONENT,this.pageSize)),this.loadingExecutions=!0,this.retentionService.listRetentionExecutionsResponse({id:this.retentionId,page:this.currentPage,pageSize:this.pageSize}).pipe((0,m.x)(()=>this.loadingExecutions=!1)).subscribe({next:n=>{if(n.headers){let o=n.headers.get("x-total-count");o&&(this.totalCount=parseInt(o,0))}this.executionList=n.body,i.calculateDuration(this.executionList),this.loopGettingExecutions()},error:n=>{this.errorHandler.error(n)}})):setTimeout(()=>{this.loadingExecutions=!1},0)}static calculateDuration(t){if(t&&t.length>0)for(let n=0;n<t.length;n++)if(t[n].end_time&&t[n].start_time){let o=new Date(t[n].end_time).getTime()-new Date(t[n].start_time).getTime(),s=Math.floor(o/6e4),h=Math.floor(o%6e4/1e3);t[n].duration="",(s||h)&&o>0?(s&&(t[n].duration+=s+"min"),h&&(t[n].duration+=h+"sec")):t[n].duration="0"}else t[n].duration="N/A"}abortRun(){this.isAbortedOpened=!0,this.retentionService.operateRetentionExecution({id:this.retentionId,eid:this.selectedItem.id,body:{action:y.STOP}}).subscribe({next:t=>{this.refreshList()},error:t=>{this.errorHandler.error(t)}})}abortRetention(){this.isAbortedOpened=!1}openEditor(t){this.ruleIndex=this.ruleIndex!==t?t:-1}refreshAfterCreatRetention(){this.projectService.getProject({projectNameOrId:this.projectId.toString()}).subscribe({next:t=>{this.retentionId=+t.metadata.retention_id,this.refreshList(),this.getRetention()},error:t=>{this.loadingRule=!1,this.errorHandler.error(t)}})}clickAdd(t){if(this.loadingRule=!0,this.addRuleComponent.onGoing=!0,this.addRuleComponent.isAdd){let n=(0,u.d9)(this.retention);n.rules.push(t),this.retentionId?this.updateRetention(n):this.retentionService.createRetention({policy:n}).subscribe({next:o=>{this.refreshAfterCreatRetention(),this.addRuleComponent.close(),this.addRuleComponent.onGoing=!1},error:o=>{o&&o.error&&o.error.message&&(o=this.tagRetentionService.getI18nKey(o.error.message)),this.addRuleComponent.inlineAlert.showInlineError(o),this.loadingRule=!1,this.addRuleComponent.onGoing=!1}})}else{let n=(0,u.d9)(this.retention);n.rules[this.editIndex]=t,this.updateRetention(n)}}updateRetention(t){this.retentionService.updateRetention({id:this.retentionId,policy:t}).subscribe({next:n=>{this.getRetention(),this.addRuleComponent.close(),this.addRuleComponent.onGoing=!1},error:n=>{this.loadingRule=!1,this.addRuleComponent.onGoing=!1,n&&n.error&&n.error.message&&(n=this.tagRetentionService.getI18nKey(n.error.message)),this.addRuleComponent.inlineAlert.showInlineError(n)}})}seeLog(t,n){this.tagRetentionService.seeLog(this.retentionId,t,n)}formatPattern(t){let n=t;return/^{\S+}$/.test(n)?n.slice(1,n.length-1):n}getI18nKey(t){return this.tagRetentionService.getI18nKey(t)}clrLoad(t){this.refreshList(t)}showUntagged(t){return JSON.parse(t).untagged}}return(r=i).\u0275fac=function(t){return new(t||r)(e.Y36(_.gz),e.Y36(f),e.Y36(Z.e),e.Y36(C.q),e.Y36(q.Y))},r.\u0275cmp=e.Xpm({type:r,selectors:[["tag-retention"]],viewQuery:function(t,n){if(1&t&&(e.Gf(j,5),e.Gf(Y,5)),2&t){let o;e.iGM(o=e.CRH())&&(n.cronScheduleComponent=o.first),e.iGM(o=e.CRH())&&(n.addRuleComponent=o.first)}},decls:127,vars:113,consts:[[1,"clr-row","pt-1","fw8"],[1,"clr-col"],[1,"label-left","font-style"],[1,"badge","badge-3","ml-5"],["class","spinner spinner-inline ml-2",4,"ngIf"],[1,"clr-row","pt-1"],["class","list-unstyled",4,"ngIf"],[1,"v-center","clr-row",3,"ngClass"],[1,"clr-col-2","flex-150"],[1,"flex-8p"],["id","add-rule",1,"btn","btn-primary",3,"disabled","click"],[1,"cron-selection"],[3,"labelWidth","disabled","labelCurrent","labelEdit","originCron","inputvalue"],["cronScheduleComponent",""],[4,"ngIf"],[1,"clr-col-2","pt-2","flex-150"],[1,"clr-col-10"],["id","run-now",1,"btn","btn-outline",3,"disabled","click"],["shape","play"],[1,"ml-5"],["id","dry-run",1,"btn","btn-outline",3,"disabled","click"],[1,"btn","btn-outline",3,"disabled","click"],["shape","stop"],["shape","refresh"],[3,"clrDgLoading","clrDgSingleSelected","clrDgRefresh","clrDgSingleSelectedChange"],[3,"clrDgItem",4,"ngFor","ngForOf"],[3,"clrDgTotalItems","clrDgPage","clrDgPageSize","clrDgPageChange"],["pagination",""],[3,"clrPageSizeOptions"],[3,"retention","clickAdd"],["addRule",""],[3,"clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalOpenChange"],[1,"modal-title"],[1,"modal-body","pt-1"],["role","alert",1,"alert","alert-danger"],[1,"alert-items"],[1,"alert-item","static"],[1,"alert-icon-wrapper"],["shape","exclamation-triangle",1,"alert-icon"],[1,"alert-text"],[1,"modal-footer"],["type","button",1,"btn","btn-outline",3,"click"],["id","execute-run","type","button",1,"btn","btn-primary",3,"click"],[1,"modal-body"],[1,"color-97"],["type","button",1,"btn","btn-primary",3,"click"],["id","schedule-ok","type","button",1,"btn","btn-primary",3,"click"],["class","backdrop-transparent",3,"click",4,"ngIf"],[1,"spinner","spinner-inline","ml-2"],[1,"list-unstyled"],["class","rule",4,"ngFor","ngForOf"],[1,"rule"],[1,"clr-row"],[1,"dropdown",3,"ngClass"],[1,"padding-left-0","dropdown-toggle","btn","btn-sm","btn-link",3,"click"],["shape","caret down"],[1,"dropdown-menu"],["type","button","class","dropdown-item",3,"click",4,"ngIf"],["type","button",1,"dropdown-item",3,"click"],["class","color-green","shape","success-standard",4,"ngIf"],["class","ml-0 color-red","shape","error-standard",4,"ngIf"],[1,"rule-name","ml-5"],["shape","success-standard",1,"color-green"],["shape","error-standard",1,"ml-0","color-red"],[1,"ml-1","mr-1","font-style"],[3,"clrDgItem"],["ngProjectAs","clr-dg-row-detail",5,["clr-dg-row-detail"],3,"executionId","retentionId",4,"clrIfExpanded"],["ngProjectAs","clr-dg-row-detail",5,["clr-dg-row-detail"],3,"executionId","retentionId"],[1,"backdrop-transparent",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"span",3),e._uU(6),e.qZA(),e.YNc(7,K,2,0,"span",4),e.qZA()(),e.TgZ(8,"div",5)(9,"div",1),e.YNc(10,ee,2,1,"ul",6),e.TgZ(11,"div",7),e._UZ(12,"div",8),e.TgZ(13,"div",9)(14,"button",10),e.NdJ("click",function(){return n.openAddRule()}),e._uU(15),e.ALo(16,"translate"),e.qZA()()()()(),e.TgZ(17,"div",11)(18,"cron-selection",12,13),e.NdJ("inputvalue",function(s){return n.openConfirm(s)}),e.qZA(),e.YNc(20,te,7,6,"ng-container",14),e.qZA(),e.TgZ(21,"div",5)(22,"div",15)(23,"label",2),e._uU(24),e.ALo(25,"translate"),e.qZA()(),e.TgZ(26,"div",16)(27,"clr-dg-action-bar")(28,"button",17),e.NdJ("click",function(){return n.isRetentionRunOpened=!0}),e._UZ(29,"clr-icon",18),e.TgZ(30,"span",19),e._uU(31),e.ALo(32,"translate"),e.qZA()(),e.TgZ(33,"button",20),e.NdJ("click",function(){return n.whatIfRun()}),e._uU(34),e.ALo(35,"translate"),e.qZA(),e.TgZ(36,"button",21),e.NdJ("click",function(){return n.abortRun()}),e._UZ(37,"clr-icon",22),e.TgZ(38,"span",19),e._uU(39),e.ALo(40,"translate"),e.qZA()(),e.TgZ(41,"button",21),e.NdJ("click",function(){return n.refreshList()}),e._UZ(42,"clr-icon",23),e.qZA()(),e.TgZ(43,"clr-datagrid",24),e.NdJ("clrDgRefresh",function(s){return n.clrLoad(s)})("clrDgSingleSelectedChange",function(s){return n.selectedItem=s}),e.TgZ(44,"clr-dg-column"),e._uU(45),e.ALo(46,"translate"),e.qZA(),e.TgZ(47,"clr-dg-column"),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.TgZ(50,"clr-dg-column"),e._uU(51),e.ALo(52,"translate"),e.qZA(),e.TgZ(53,"clr-dg-column"),e._uU(54),e.ALo(55,"translate"),e.qZA(),e.TgZ(56,"clr-dg-column"),e._uU(57),e.ALo(58,"translate"),e.qZA(),e.TgZ(59,"clr-dg-column"),e._uU(60),e.ALo(61,"translate"),e.qZA(),e.TgZ(62,"clr-dg-placeholder"),e._uU(63),e.ALo(64,"translate"),e.qZA(),e.YNc(65,le,18,14,"clr-dg-row",25),e.TgZ(66,"clr-dg-footer")(67,"clr-dg-pagination",26,27),e.NdJ("clrDgPageChange",function(s){return n.currentPage=s}),e.TgZ(69,"clr-dg-page-size",28),e._uU(70),e.ALo(71,"translate"),e.qZA(),e.YNc(72,re,3,5,"span",14),e._uU(73),e.ALo(74,"translate"),e.qZA()()()()(),e.TgZ(75,"add-rule",29,30),e.NdJ("clickAdd",function(s){return n.clickAdd(s)}),e.qZA(),e.TgZ(77,"clr-modal",31),e.NdJ("clrModalOpenChange",function(s){return n.isRetentionRunOpened=s}),e.TgZ(78,"h3",32),e._uU(79),e.ALo(80,"translate"),e.qZA(),e.TgZ(81,"div",33)(82,"div",34)(83,"div",35)(84,"div",36)(85,"div",37),e._UZ(86,"clr-icon",38),e.qZA(),e.TgZ(87,"span",39),e._uU(88),e.ALo(89,"translate"),e.qZA()()()()(),e.TgZ(90,"div",40)(91,"button",41),e.NdJ("click",function(){return n.isRetentionRunOpened=!1}),e._uU(92),e.ALo(93,"translate"),e.qZA(),e.TgZ(94,"button",42),e.NdJ("click",function(){return n.runRetention()}),e._uU(95),e.ALo(96,"translate"),e.qZA()()(),e.TgZ(97,"clr-modal",31),e.NdJ("clrModalOpenChange",function(s){return n.isAbortedOpened=s}),e.TgZ(98,"h3",32),e._uU(99),e.ALo(100,"translate"),e.qZA(),e.TgZ(101,"div",43)(102,"p",44),e._uU(103),e.ALo(104,"translate"),e.qZA()(),e.TgZ(105,"div",40)(106,"button",45),e.NdJ("click",function(){return n.abortRetention()}),e._uU(107),e.ALo(108,"translate"),e.qZA()()(),e.TgZ(109,"clr-modal",31),e.NdJ("clrModalOpenChange",function(s){return n.isConfirmOpened=s}),e.TgZ(110,"h3",32),e._uU(111),e.ALo(112,"translate"),e.qZA(),e.TgZ(113,"div",33)(114,"div",34)(115,"div",35)(116,"div",36)(117,"div",37),e._UZ(118,"clr-icon",38),e.qZA(),e.TgZ(119,"span",39),e._uU(120),e.ALo(121,"translate"),e.qZA()()()()(),e.TgZ(122,"div",40)(123,"button",46),e.NdJ("click",function(){return n.closeConfirm()}),e._uU(124),e.ALo(125,"translate"),e.qZA()()(),e.YNc(126,oe,1,0,"div",47)),2&t&&(e.xp6(3),e.Oqu(e.lcZ(4,60,"TAG_RETENTION.RETENTION_RULES")),e.xp6(3),e.hij("",null!=n.retention&&null!=n.retention.rules&&n.retention.rules.length?null==n.retention||null==n.retention.rules?null:n.retention.rules.length:0,"/15"),e.xp6(1),e.Q6J("ngIf",n.loadingRule),e.xp6(3),e.Q6J("ngIf",(null==n.retention||null==n.retention.rules?null:n.retention.rules.length)>0),e.xp6(1),e.Q6J("ngClass",e.VKq(110,ie,(null==n.retention||null==n.retention.rules?null:n.retention.rules.length)>0)),e.xp6(3),e.Q6J("disabled",(null==n.retention||null==n.retention.rules?null:n.retention.rules.length)>=15),e.xp6(1),e.hij(" ",e.lcZ(16,62,"TAG_RETENTION.ADD_RULE")," "),e.xp6(3),e.Q6J("labelWidth","150px")("disabled",!((null==n.retention||null==n.retention.rules?null:n.retention.rules.length)>0))("labelCurrent",n.label)("labelEdit",n.label)("originCron",n.originCron()),e.xp6(2),e.Q6J("ngIf",null==n.retention||null==n.retention.trigger||null==n.retention.trigger.settings?null:n.retention.trigger.settings.next_scheduled_time),e.xp6(4),e.Oqu(e.lcZ(25,64,"TAG_RETENTION.RETENTION_RUNS")),e.xp6(4),e.Q6J("disabled",!((null==n.retention||null==n.retention.rules?null:n.retention.rules.length)>0)),e.xp6(3),e.Oqu(e.lcZ(32,66,"TAG_RETENTION.RUN_NOW")),e.xp6(2),e.Q6J("disabled",!((null==n.retention||null==n.retention.rules?null:n.retention.rules.length)>0)),e.xp6(1),e.hij(" ",e.lcZ(35,68,"TAG_RETENTION.WHAT_IF_RUN")," "),e.xp6(2),e.Q6J("disabled",!(n.selectedItem&&("InProgress"===n.selectedItem.status||"Running"===n.selectedItem.status))),e.xp6(3),e.Oqu(e.lcZ(40,70,"TAG_RETENTION.ABORT")),e.xp6(2),e.Q6J("disabled",!n.retentionId),e.xp6(2),e.Q6J("clrDgLoading",n.loadingExecutions)("clrDgSingleSelected",n.selectedItem),e.xp6(2),e.hij(" ",e.lcZ(46,72,"TAG_RETENTION.SERIAL")," "),e.xp6(3),e.hij(" ",e.lcZ(49,74,"TAG_RETENTION.STATUS")," "),e.xp6(3),e.hij(" ",e.lcZ(52,76,"TAG_RETENTION.DRY_RUN")," "),e.xp6(3),e.hij(" ",e.lcZ(55,78,"TAG_RETENTION.EXECUTION_TYPE")," "),e.xp6(3),e.hij(" ",e.lcZ(58,80,"TAG_RETENTION.START_TIME")," "),e.xp6(3),e.hij(" ",e.lcZ(61,82,"TAG_RETENTION.DURATION")," "),e.xp6(3),e.hij(" ",e.lcZ(64,84,"TAG_RETENTION.NO_EXECUTION")," "),e.xp6(2),e.Q6J("ngForOf",n.executionList),e.xp6(2),e.Q6J("clrDgTotalItems",n.totalCount)("clrDgPage",n.currentPage)("clrDgPageSize",n.pageSize),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(112,se)),e.xp6(1),e.Oqu(e.lcZ(71,86,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",n.totalCount),e.xp6(1),e.AsE(" ",n.totalCount," ",e.lcZ(74,88,"ROBOT_ACCOUNT.ITEMS")," "),e.xp6(2),e.Q6J("retention",n.retention),e.xp6(2),e.Q6J("clrModalOpen",n.isRetentionRunOpened)("clrModalStaticBackdrop",!0)("clrModalClosable",!0),e.xp6(2),e.Oqu(e.lcZ(80,90,"TAG_RETENTION.RETENTION_RUN")),e.xp6(9),e.hij(" ",e.lcZ(89,92,"TAG_RETENTION.RETENTION_RUN_EXPLAIN")," "),e.xp6(4),e.hij(" ",e.lcZ(93,94,"BUTTON.CANCEL")," "),e.xp6(3),e.hij(" ",e.lcZ(96,96,"BUTTON.RUN")," "),e.xp6(2),e.Q6J("clrModalOpen",n.isAbortedOpened)("clrModalStaticBackdrop",!0)("clrModalClosable",!0),e.xp6(2),e.hij(" ",e.lcZ(100,98,"TAG_RETENTION.RETENTION_RUN_ABORTED")," "),e.xp6(4),e.hij(" ",e.lcZ(104,100,"TAG_RETENTION.RETENTION_RUN_ABORTED_EXPLAIN")," "),e.xp6(4),e.hij(" ",e.lcZ(108,102,"BUTTON.OK")," "),e.xp6(2),e.Q6J("clrModalOpen",n.isConfirmOpened)("clrModalStaticBackdrop",!0)("clrModalClosable",!0),e.xp6(2),e.Oqu(e.lcZ(112,104,"TAG_RETENTION.SCHEDULE")),e.xp6(9),e.hij(" ",e.lcZ(121,106,"TAG_RETENTION.SCHEDULE_WARNING")," "),e.xp6(4),e.hij(" ",e.lcZ(125,108,"BUTTON.OK")," "),e.xp6(2),e.Q6J("ngIf",-1!==n.ruleIndex))},styles:[".color-97[_ngcontent-%COMP%]{color:#979797}.rule[_ngcontent-%COMP%]{height:24px;line-height:24px}.rule-name[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:.5417rem}.ml-5[_ngcontent-%COMP%]{margin-left:5px}.width-60[_ngcontent-%COMP%]{width:60px}.hand[_ngcontent-%COMP%]{cursor:pointer}.datagrid-container[_ngcontent-%COMP%]{padding:0}.color-79b[_ngcontent-%COMP%]{color:#0079b8}.backdrop-transparent[_ngcontent-%COMP%]{position:fixed;inset:0;opacity:0;z-index:999}.cron-selection[_ngcontent-%COMP%]{margin-top:30px;display:flex;align-items:center}.v-center[_ngcontent-%COMP%]{height:48px;line-height:48px}.font-size-54[_ngcontent-%COMP%]{font-size:.5417rem}.flex-150[_ngcontent-%COMP%]{flex:0 0 150px;max-width:150px}.padding-left-0[_ngcontent-%COMP%]{padding-left:0}.flex-8p[_ngcontent-%COMP%]{flex:0 0 8.3%;padding-left:.5rem}[_nghost-%COMP%]  .datagrid-row-flex .datagrid-row-detail .datagrid-cell{padding:11px 12px}"]}),i})();var de=c(4554),R=c(208),d=c(6223),a=c(8280),p=c(6814);function pe(r,i){1&r&&(e.TgZ(0,"h3",3),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TAG_RETENTION.ADD_TITLE")," "))}function ge(r,i){1&r&&(e.TgZ(0,"h3",3),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TAG_RETENTION.EDIT_TITLE")," "))}function _e(r,i){if(1&r&&(e.TgZ(0,"option",35),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const l=i.$implicit,t=e.oxw();e.s9C("value",l),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.getI18nKey(l))," ")}}function he(r,i){if(1&r&&(e.TgZ(0,"option",35),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e.qZA()),2&r){const l=i.$implicit,t=e.oxw();e.s9C("value",null==l?null:l.rule_template),e.xp6(1),e.AsE(" ",e.lcZ(2,3,t.getI18nKey(null==l?null:l.action)),"",e.lcZ(3,5,t.getI18nKey(null==l?null:l.display_text))," ")}}function Te(r,i){if(1&r&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const l=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,l.getI18nKey(l.unit)))}}function me(r,i){if(1&r){const l=e.EpF();e.TgZ(0,"input",36),e.NdJ("ngModelChange",function(n){e.CHM(l);const o=e.oxw();return e.KtG(o.num=n)}),e.qZA()}if(2&r){const l=e.oxw();e.Q6J("ngModel",l.num)}}function Ae(r,i){if(1&r&&(e.TgZ(0,"option",35),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const l=i.$implicit,t=e.oxw();e.s9C("value",l),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.getI18nKey(l))," ")}}function fe(r,i){1&r&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BUTTON.ADD")))}function Ie(r,i){1&r&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BUTTON.SAVE")))}let Ee=(()=>{var r;class i{constructor(t){this.tagRetentionService=t,this.addRuleOpened=!1,this.clickAdd=new e.vpe,this.metadata=new M,this.rule=new L,this.isAdd=!0,this.onGoing=!1}set template(t){this.rule.template=t}get template(){return this.rule.template}get unit(){let t="";return this.metadata.templates.forEach(n=>{n.rule_template===this.rule.template&&(t=n.params[0].unit)}),t}get num(){return this.rule.params[this.template]}set num(t){t&&(t=t.trim()),parseInt(t,10)>0&&(t=parseInt(t,10)),this.rule.params[this.template]=t}get repoSelect(){return this.rule.scope_selectors.repository[0].decoration}set repoSelect(t){this.rule.scope_selectors.repository[0].decoration=t}set repositories(t){this.rule.scope_selectors.repository[0].pattern=-1!==t.indexOf(",")&&-1===t.indexOf("{")&&-1===t.indexOf("}")?"{"+t+"}":t}get repositories(){let t=this.rule.scope_selectors.repository[0].pattern;return/^{\S+}$/.test(t)?t.slice(1,t.length-1):t}get tagsSelect(){return this.rule.tag_selectors[0].decoration}set tagsSelect(t){this.rule.tag_selectors[0].decoration=t}set tagsInput(t){this.rule.tag_selectors[0].pattern=-1!==t.indexOf(",")&&-1===t.indexOf("{")&&-1===t.indexOf("}")?"{"+t+"}":t}get tagsInput(){let t=this.rule.tag_selectors[0].pattern;return/^{\S+}$/.test(t)?t.slice(1,t.length-1):t}set untagged(t){let n=JSON.parse(this.rule.tag_selectors[0].extras);n.untagged=t,this.rule.tag_selectors[0].extras=JSON.stringify(n)}get untagged(){if(this.rule.tag_selectors[0]&&this.rule.tag_selectors[0].extras){let t=JSON.parse(this.rule.tag_selectors[0].extras);return void 0!==t.untagged&&t.untagged}return!1}get labelsSelect(){return this.rule.tag_selectors[1].decoration}set labelsSelect(t){this.rule.tag_selectors[1].decoration=t}set labelsInput(t){this.rule.tag_selectors[1].pattern=t}get labelsInput(){return this.rule.tag_selectors[1].pattern}canNotAdd(){return!(!(this.onGoing||!this.isAdd&&(0,u.jy)(this.editRuleOrigin,this.rule))&&(this.hasParam()?this.rule.template&&this.rule.params[this.template]&&parseInt(this.rule.params[this.template],10)>=0&&parseInt(this.rule.params[this.template],10)<21e8&&this.rule.scope_selectors.repository[0].pattern&&this.rule.scope_selectors.repository[0].pattern.replace(/[{}]/g,"")&&this.rule.tag_selectors[0].pattern&&this.rule.tag_selectors[0].pattern.replace(/[{}]/g,""):this.rule.template&&this.rule.scope_selectors.repository[0].pattern&&this.rule.scope_selectors.repository[0].pattern.replace(/[{}]/g,"")&&this.rule.tag_selectors[0].pattern&&this.rule.tag_selectors[0].pattern.replace(/[{}]/g,"")))}open(){this.addRuleOpened=!0,this.inlineAlert.alertClose=!0,this.onGoing=!1}close(){this.addRuleOpened=!1}cancel(){this.close()}add(){if("0"===this.rule.params[this.template]&&(this.rule.params[this.template]=0),this.rule.scope_selectors.repository[0].pattern=this.rule.scope_selectors.repository[0].pattern.replace(/\s+/g,""),this.rule.tag_selectors[0].pattern=this.rule.tag_selectors[0].pattern.replace(/\s+/g,""),"repoMatches"!==this.rule.scope_selectors.repository[0].decoration&&this.rule.scope_selectors.repository[0].pattern){let t=this.rule.scope_selectors.repository[0].pattern;t=t.replace(/[{}]/g,"");const n=t.split(",");for(let o=0;o<n.length;o++)if(n[o]&&n[o].trim()&&"**"===n[o])return void this.inlineAlert.showInlineError("TAG_RETENTION.INVALID_RULE")}this.isExistingRule()?this.inlineAlert.showInlineError("TAG_RETENTION.EXISTING_RULE"):this.clickAdd.emit(this.rule)}isExistingRule(){if(this.retention&&this.retention.rules&&this.retention.rules.length>0)for(let t=0;t<this.retention.rules.length;t++)if(this.isSameRule(this.retention.rules[t]))return!0;return!1}isSameRule(t){return!(this.rule.scope_selectors.repository[0].decoration!==t.scope_selectors.repository[0].decoration||this.rule.scope_selectors.repository[0].pattern!==t.scope_selectors.repository[0].pattern||this.rule.template!==t.template||this.hasParam()&&JSON.stringify(this.rule.params)!==JSON.stringify(t.params)||this.rule.tag_selectors[0].decoration!==t.tag_selectors[0].decoration||this.rule.tag_selectors[0].extras!==t.tag_selectors[0].extras)&&this.rule.tag_selectors[0].pattern===t.tag_selectors[0].pattern}getI18nKey(t){return this.tagRetentionService.getI18nKey(t)}hasParam(){if(this.metadata&&this.metadata.templates){let t=!1;return this.metadata.templates.forEach(n=>{n.rule_template===this.template&&n.params&&n.params.length>0&&(t=!0)}),t}return!1}}return(r=i).\u0275fac=function(t){return new(t||r)(e.Y36(f))},r.\u0275cmp=e.Xpm({type:r,selectors:[["add-rule"]],viewQuery:function(t,n){if(1&t&&e.Gf(R.l,5),2&t){let o;e.iGM(o=e.CRH())&&(n.inlineAlert=o.first)}},inputs:{retention:"retention"},outputs:{clickAdd:"clickAdd"},decls:77,vars:44,consts:[[3,"clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalSize","clrModalOpenChange"],["class","modal-title",4,"ngIf"],[1,"modal-body","no-scrolling"],[1,"modal-title"],[1,"color-97"],[1,"height-72"],[1,"clr-row","mt-1"],[1,"clr-col-4"],[1,"clr-col-2"],[1,"clr-select-wrapper","w-100"],[1,"clr-select","w-100",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"clr-col-6"],[1,"w-100"],["id","repos","required","",1,"clr-input","w-100",3,"ngModel","ngModelChange"],[1,"clr-row"],[1,"clr-col-8","margin-top-5px"],[1,"tootip"],[1,"over-line"],[1,"clr-col-5"],["id","template",1,"clr-select","w-100",3,"ngModel","ngModelChange"],["value","",1,"display-none"],[1,"clr-col-3"],[4,"ngIf"],[1,"w-100","disabled"],["id","param","class","clr-input w-100",3,"ngModel","ngModelChange",4,"ngIf"],[1,"height-95"],["id","tags","required","",1,"clr-input","w-100",3,"ngModel","ngModelChange"],[1,"clr-col-3","p-0"],[1,"w-100","untagged"],["for","untagged"],["type","checkbox","name","untagged","id","untagged","clrCheckbox","",1,"clr-input","w-100",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","button",1,"btn","btn-outline",3,"click"],["id","save-add","type","button",1,"btn","btn-primary",3,"disabled","click"],[3,"value"],["id","param",1,"clr-input","w-100",3,"ngModel","ngModelChange"]],template:function(t,n){1&t&&(e.TgZ(0,"clr-modal",0),e.NdJ("clrModalOpenChange",function(s){return n.addRuleOpened=s}),e.YNc(1,pe,3,3,"h3",1),e.YNc(2,ge,3,3,"h3",1),e.TgZ(3,"div",2),e._UZ(4,"inline-alert",3),e.TgZ(5,"p",4),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"div",5)(9,"div",6)(10,"div",7)(11,"span"),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"div",8)(15,"div",9)(16,"select",10),e.NdJ("ngModelChange",function(s){return n.repoSelect=s}),e.YNc(17,_e,3,4,"option",11),e.qZA()()(),e.TgZ(18,"div",12)(19,"div",13)(20,"input",14),e.NdJ("ngModelChange",function(s){return n.repositories=s}),e.qZA()()()(),e.TgZ(21,"div",15),e._UZ(22,"div",7),e.TgZ(23,"div",16)(24,"span",17),e._uU(25),e.ALo(26,"translate"),e.qZA()()()(),e.TgZ(27,"div",5)(28,"div",15)(29,"div",7),e._UZ(30,"div",18),e.TgZ(31,"label"),e._uU(32),e.ALo(33,"translate"),e.qZA()(),e.TgZ(34,"div",19),e._UZ(35,"div",18),e.TgZ(36,"div",9)(37,"select",20),e.NdJ("ngModelChange",function(s){return n.template=s}),e._UZ(38,"option",21),e.YNc(39,he,4,7,"option",11),e.qZA()()(),e.TgZ(40,"div",22)(41,"div",18),e.YNc(42,Te,3,3,"span",23),e.qZA(),e.TgZ(43,"div",24),e.YNc(44,me,1,1,"input",25),e.qZA()()()(),e.TgZ(45,"div",26)(46,"div",15)(47,"div",7)(48,"label"),e._uU(49),e.ALo(50,"translate"),e.qZA()(),e.TgZ(51,"div",8)(52,"div",9)(53,"select",10),e.NdJ("ngModelChange",function(s){return n.tagsSelect=s}),e.YNc(54,Ae,3,4,"option",11),e.qZA()()(),e.TgZ(55,"div",22)(56,"div",13)(57,"input",27),e.NdJ("ngModelChange",function(s){return n.tagsInput=s}),e.qZA()()(),e.TgZ(58,"div",28)(59,"div",29)(60,"label",30),e._uU(61),e.ALo(62,"translate"),e.qZA(),e.TgZ(63,"input",31),e.NdJ("ngModelChange",function(s){return n.untagged=s}),e.qZA()()()(),e.TgZ(64,"div",15),e._UZ(65,"div",7),e.TgZ(66,"div",16)(67,"span",17),e._uU(68),e.ALo(69,"translate"),e.qZA()()()()(),e.TgZ(70,"div",32)(71,"button",33),e.NdJ("click",function(){return n.cancel()}),e._uU(72),e.ALo(73,"translate"),e.qZA(),e.TgZ(74,"button",34),e.NdJ("click",function(){return n.add()}),e.YNc(75,fe,3,3,"span",23),e.YNc(76,Ie,3,3,"span",23),e.qZA()()()),2&t&&(e.Q6J("clrModalOpen",n.addRuleOpened)("clrModalStaticBackdrop",!0)("clrModalClosable",!0)("clrModalSize","lg"),e.xp6(1),e.Q6J("ngIf",n.isAdd),e.xp6(1),e.Q6J("ngIf",!n.isAdd),e.xp6(4),e.Oqu(e.lcZ(7,28,"TAG_RETENTION.ADD_SUBTITLE")),e.xp6(6),e.Oqu(e.lcZ(13,30,"TAG_RETENTION.IN_REPOSITORIES")),e.xp6(4),e.Q6J("ngModel",n.repoSelect),e.xp6(1),e.Q6J("ngForOf",null==n.metadata||null==n.metadata.scope_selectors[0]?null:n.metadata.scope_selectors[0].decorations),e.xp6(3),e.Q6J("ngModel",n.repositories),e.xp6(5),e.Oqu(e.lcZ(26,32,"TAG_RETENTION.REP_SEPARATOR")),e.xp6(7),e.Oqu(e.lcZ(33,34,"TAG_RETENTION.BY_WHAT")),e.xp6(5),e.Q6J("ngModel",n.template),e.xp6(2),e.Q6J("ngForOf",null==n.metadata?null:n.metadata.templates),e.xp6(3),e.Q6J("ngIf",n.hasParam()),e.xp6(2),e.Q6J("ngIf",n.hasParam()),e.xp6(5),e.Oqu(e.lcZ(50,36,"TAG_RETENTION.TAGS")),e.xp6(4),e.Q6J("ngModel",n.tagsSelect),e.xp6(1),e.Q6J("ngForOf",null==n.metadata||null==n.metadata.tag_selectors[0]?null:n.metadata.tag_selectors[0].decorations),e.xp6(3),e.Q6J("ngModel",n.tagsInput),e.xp6(4),e.Oqu(e.lcZ(62,38,"TAG_RETENTION.INCLUDE_UNTAGGED")),e.xp6(2),e.Q6J("ngModel",n.untagged),e.xp6(5),e.Oqu(e.lcZ(69,40,"TAG_RETENTION.TAG_SEPARATOR")),e.xp6(4),e.hij(" ",e.lcZ(73,42,"BUTTON.CANCEL")," "),e.xp6(2),e.Q6J("disabled",n.canNotAdd()),e.xp6(1),e.Q6J("ngIf",n.isAdd),e.xp6(1),e.Q6J("ngIf",!n.isAdd))},dependencies:[d.YN,d.Kr,d.Fj,d.Wl,d.EJ,d.JJ,d.Q7,d.On,a.qAN,a.VLi,a.MgK,a.KKC,p.sg,p.O5,R.l,T.X$],styles:[".color-97[_ngcontent-%COMP%]{color:#979797}.over-line[_ngcontent-%COMP%]{height:15px;line-height:15px;font-size:10px}.height-72[_ngcontent-%COMP%]{height:72px}.height-95[_ngcontent-%COMP%]{height:95px}.display-none[_ngcontent-%COMP%]{display:none}.untagged[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.modal-body[_ngcontent-%COMP%]{overflow-y:hidden}.tootip[_ngcontent-%COMP%]{display:block;line-height:.9rem}.font-size-13[_ngcontent-%COMP%]{font-size:13px}.margin-top-5px[_ngcontent-%COMP%]{margin-top:5px}"]}),i})(),O=(()=>{var r;class i{constructor(){this.I18nMap={repoMatches:"MAT",repoExcludes:"EXC",matches:"MAT",excludes:"EXC",withLabels:"WITH",withoutLabels:"WITHOUT",none:"NONE",nothing:"NONE"}}getI18nKey(t){return this.I18nMap[t.trim()]?"IMMUTABLE_TAG."+this.I18nMap[t.trim()]:t}}return(r=i).\u0275fac=function(t){return new(t||r)},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac}),i})();var Oe=c(8490);function xe(r,i){1&r&&(e.TgZ(0,"h3",3),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"IMMUTABLE_TAG.ADD_TITLE")," "))}function Ne(r,i){1&r&&(e.TgZ(0,"h3",3),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"IMMUTABLE_TAG.EDIT_TITLE")," "))}function be(r,i){if(1&r&&(e.TgZ(0,"option",23),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const l=i.$implicit,t=e.oxw();e.s9C("value",l),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.getI18nKey(l))," ")}}function Le(r,i){if(1&r&&(e.TgZ(0,"option",23),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const l=i.$implicit,t=e.oxw();e.s9C("value",l),e.xp6(1),e.hij(" ",e.lcZ(2,2,t.getI18nKey(l))," ")}}function Me(r,i){1&r&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BUTTON.ADD")))}function Ue(r,i){1&r&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"BUTTON.SAVE")))}let ye=(()=>{var r;class i{constructor(t){this.immutableTagService=t,this.addRuleOpened=!1,this.clickAdd=new e.vpe,this.metadata=new M,this.isAdd=!0,this.onGoing=!1,this.rule=new b(this.projectId)}get repoSelect(){return this.rule&&this.rule.scope_selectors&&this.rule.scope_selectors.repository[0]?this.rule.scope_selectors.repository[0].decoration:""}set repoSelect(t){this.rule&&this.rule.scope_selectors&&this.rule.scope_selectors.repository[0]&&(this.rule.scope_selectors.repository[0].decoration=t)}set repositories(t){this.rule&&this.rule.scope_selectors&&this.rule.scope_selectors.repository&&this.rule.scope_selectors.repository[0]&&(this.rule.scope_selectors.repository[0].pattern=-1!==t.indexOf(",")&&-1===t.indexOf("{")&&-1===t.indexOf("}")?"{"+t+"}":t)}get repositories(){if(this.rule&&this.rule.scope_selectors&&this.rule.scope_selectors.repository&&this.rule.scope_selectors.repository[0]&&this.rule.scope_selectors.repository[0].pattern){let t=this.rule.scope_selectors.repository[0].pattern;return/^{\S+}$/.test(t)?t.slice(1,t.length-1):t}return""}get tagsSelect(){return this.rule&&this.rule.tag_selectors&&this.rule.tag_selectors[0]?this.rule.tag_selectors[0].decoration:""}set tagsSelect(t){this.rule&&this.rule.tag_selectors&&this.rule.tag_selectors[0]&&(this.rule.tag_selectors[0].decoration=t)}set tagsInput(t){this.rule&&this.rule.tag_selectors&&this.rule.tag_selectors[0]&&(this.rule.tag_selectors[0].pattern=-1!==t.indexOf(",")&&-1===t.indexOf("{")&&-1===t.indexOf("}")?"{"+t+"}":t)}get tagsInput(){if(this.rule&&this.rule.tag_selectors&&this.rule.tag_selectors[0]&&this.rule.tag_selectors[0].pattern){let t=this.rule.tag_selectors[0].pattern;return/^{\S+}$/.test(t)?t.slice(1,t.length-1):t}return""}canNotAdd(){return!!(this.onGoing||!this.isAdd&&(0,u.jy)(this.editRuleOrigin,this.rule))||!(this.rule&&this.rule.scope_selectors&&this.rule.scope_selectors.repository&&this.rule.scope_selectors.repository[0]&&this.rule.scope_selectors.repository[0].pattern&&this.rule.scope_selectors.repository[0].pattern.replace(/[{}]/g,"")&&this.rule.tag_selectors&&this.rule.tag_selectors[0]&&this.rule.tag_selectors[0].pattern&&this.rule.tag_selectors[0].pattern.replace(/[{}]/g,""))}open(){this.addRuleOpened=!0,this.inlineAlert.alertClose=!0,this.onGoing=!1}close(){this.addRuleOpened=!1}cancel(){this.close()}add(){if(this.rule.scope_selectors.repository[0].pattern=this.rule.scope_selectors.repository[0].pattern.replace(/\s+/g,""),this.rule.tag_selectors[0].pattern=this.rule.tag_selectors[0].pattern.replace(/\s+/g,""),"repoMatches"!==this.rule.scope_selectors.repository[0].decoration&&this.rule.scope_selectors.repository[0].pattern){let t=this.rule.scope_selectors.repository[0].pattern;t=t.replace(/[{}]/g,"");const n=t.split(",");for(let o=0;o<n.length;o++)if(n[o]&&n[o].trim()&&"**"===n[o])return void this.inlineAlert.showInlineError("TAG_RETENTION.INVALID_RULE")}this.isExistingRule()?this.inlineAlert.showInlineError("TAG_RETENTION.EXISTING_RULE"):this.clickAdd.emit(this.rule)}isExistingRule(){if(this.rules&&this.rules.length>0)for(let t=0;t<this.rules.length;t++)if(this.isSameRule(this.rules[t]))return!0;return!1}isSameRule(t){return this.rule.scope_selectors.repository[0].decoration===t.scope_selectors.repository[0].decoration&&this.rule.scope_selectors.repository[0].pattern===t.scope_selectors.repository[0].pattern&&this.rule.tag_selectors[0].decoration===t.tag_selectors[0].decoration&&this.rule.tag_selectors[0].pattern===t.tag_selectors[0].pattern}getI18nKey(t){return this.immutableTagService.getI18nKey(t)}}return(r=i).\u0275fac=function(t){return new(t||r)(e.Y36(O))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-add-immutable-rule"]],viewQuery:function(t,n){if(1&t&&e.Gf(R.l,5),2&t){let o;e.iGM(o=e.CRH())&&(n.inlineAlert=o.first)}},inputs:{rules:"rules",projectId:"projectId"},outputs:{clickAdd:"clickAdd"},decls:53,vars:33,consts:[[3,"clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalSize","clrModalOpenChange"],["class","modal-title",4,"ngIf"],[1,"modal-body","no-scrolling"],[1,"modal-title"],[1,"color-97"],[1,"height-72"],[1,"clr-row","mt-1"],[1,"clr-col-4"],[1,"clr-col-3"],[1,"clr-select-wrapper","w-100"],["id","scope_selectors",1,"clr-select","w-100",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"clr-col-5"],[1,"w-100"],["required","","id","scope-input",1,"clr-input","w-100",3,"ngModel","ngModelChange"],[1,"clr-row"],[1,"clr-col-8"],["id","tag_selectors",1,"clr-select","w-100",3,"ngModel","ngModelChange"],["required","","id","tag-input",1,"clr-input","w-100",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","button","id","close-btn",1,"btn","btn-outline",3,"click"],["type","button","id","add-edit-btn",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],[3,"value"]],template:function(t,n){1&t&&(e.TgZ(0,"clr-modal",0),e.NdJ("clrModalOpenChange",function(s){return n.addRuleOpened=s}),e.YNc(1,xe,3,3,"h3",1),e.YNc(2,Ne,3,3,"h3",1),e.TgZ(3,"div",2),e._UZ(4,"inline-alert",3),e.TgZ(5,"p",4),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"div",5)(9,"div",6)(10,"div",7)(11,"span"),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"div",8)(15,"div",9)(16,"select",10),e.NdJ("ngModelChange",function(s){return n.repoSelect=s}),e.YNc(17,be,3,4,"option",11),e.qZA()()(),e.TgZ(18,"div",12)(19,"div",13)(20,"input",14),e.NdJ("ngModelChange",function(s){return n.repositories=s}),e.qZA()()()(),e.TgZ(21,"div",15),e._UZ(22,"div",7),e.TgZ(23,"div",16)(24,"span"),e._uU(25),e.ALo(26,"translate"),e.qZA()()()(),e.TgZ(27,"div",5)(28,"div",15)(29,"div",7)(30,"label"),e._uU(31),e.ALo(32,"translate"),e.qZA()(),e.TgZ(33,"div",8)(34,"div",9)(35,"select",17),e.NdJ("ngModelChange",function(s){return n.tagsSelect=s}),e.YNc(36,Le,3,4,"option",11),e.qZA()()(),e.TgZ(37,"div",12)(38,"div",13)(39,"input",18),e.NdJ("ngModelChange",function(s){return n.tagsInput=s}),e.qZA()()()(),e.TgZ(40,"div",15),e._UZ(41,"div",7),e.TgZ(42,"div",16)(43,"span"),e._uU(44),e.ALo(45,"translate"),e.qZA()()()()(),e.TgZ(46,"div",19)(47,"button",20),e.NdJ("click",function(){return n.cancel()}),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.TgZ(50,"button",21),e.NdJ("click",function(){return n.add()}),e.YNc(51,Me,3,3,"span",22),e.YNc(52,Ue,3,3,"span",22),e.qZA()()()),2&t&&(e.Q6J("clrModalOpen",n.addRuleOpened)("clrModalStaticBackdrop",!0)("clrModalClosable",!0)("clrModalSize","lg"),e.xp6(1),e.Q6J("ngIf",n.isAdd),e.xp6(1),e.Q6J("ngIf",!n.isAdd),e.xp6(4),e.Oqu(e.lcZ(7,21,"IMMUTABLE_TAG.ADD_SUBTITLE")),e.xp6(6),e.Oqu(e.lcZ(13,23,"IMMUTABLE_TAG.IN_REPOSITORIES")),e.xp6(4),e.Q6J("ngModel",n.repoSelect),e.xp6(1),e.Q6J("ngForOf",null==n.metadata||null==n.metadata.scope_selectors[0]?null:n.metadata.scope_selectors[0].decorations),e.xp6(3),e.Q6J("ngModel",n.repositories),e.xp6(5),e.Oqu(e.lcZ(26,25,"IMMUTABLE_TAG.REP_SEPARATOR")),e.xp6(6),e.Oqu(e.lcZ(32,27,"IMMUTABLE_TAG.TAGS")),e.xp6(4),e.Q6J("ngModel",n.tagsSelect),e.xp6(1),e.Q6J("ngForOf",null==n.metadata||null==n.metadata.tag_selectors[0]?null:n.metadata.tag_selectors[0].decorations),e.xp6(3),e.Q6J("ngModel",n.tagsInput),e.xp6(5),e.Oqu(e.lcZ(45,29,"IMMUTABLE_TAG.TAG_SEPARATOR")),e.xp6(4),e.hij(" ",e.lcZ(49,31,"BUTTON.CANCEL")," "),e.xp6(2),e.Q6J("disabled",n.canNotAdd()),e.xp6(1),e.Q6J("ngIf",n.isAdd),e.xp6(1),e.Q6J("ngIf",!n.isAdd))},dependencies:[d.YN,d.Kr,d.Fj,d.EJ,d.JJ,d.Q7,d.On,a.qAN,a.VLi,a.MgK,p.sg,p.O5,R.l,T.X$],styles:[".color-97[_ngcontent-%COMP%]{color:#979797}.height-72[_ngcontent-%COMP%]{height:72px}"]}),i})();const qe=["addRule"];function Ge(r,i){1&r&&(e.TgZ(0,"span",14),e._uU(1,"Loading..."),e.qZA())}function ke(r,i){if(1&r){const l=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(l);const n=e.oxw().$implicit,o=e.oxw(2);return e.KtG(o.toggleDisable(n,!0))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&r){const l=e.oxw().index;e.s9C("id","disable-btn"+l),e.xp6(1),e.hij(" ",e.lcZ(2,2,"IMMUTABLE_TAG.DISABLE")," ")}}function Je(r,i){if(1&r){const l=e.EpF();e.TgZ(0,"button",31),e.NdJ("click",function(){e.CHM(l);const n=e.oxw().$implicit,o=e.oxw(2);return e.KtG(o.toggleDisable(n,!1))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"IMMUTABLE_TAG.ENABLE")," "))}function we(r,i){1&r&&e._UZ(0,"clr-icon",32)}function Pe(r,i){if(1&r&&e._UZ(0,"clr-icon",33),2&r){const l=e.oxw().index;e.s9C("id","disable-icon"+l)}}function De(r,i){if(1&r&&(e.ynx(0),e.TgZ(1,"span",34),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"span"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"span"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"span"),e._uU(11),e.qZA(),e.BQk()),2&r){const l=e.oxw().$implicit,t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,4,"IMMUTABLE_TAG.AND")),e.xp6(3),e.Oqu(e.lcZ(6,6,"IMMUTABLE_TAG.LOWER_LABELS")),e.xp6(3),e.Oqu(e.lcZ(9,8,t.getI18nKey(null==l||null==l.tag_selectors[1]?null:l.tag_selectors[1].decoration))),e.xp6(3),e.Oqu(null==l||null==l.tag_selectors[1]?null:l.tag_selectors[1].pattern)}}const Qe=function(r){return{open:r}};function je(r,i){if(1&r){const l=e.EpF();e.TgZ(0,"li",17)(1,"div",18)(2,"div",8)(3,"div",19)(4,"button",20),e.NdJ("click",function(){const o=e.CHM(l).index,s=e.oxw(2);return e.KtG(s.openEditor(o))}),e._uU(5),e.ALo(6,"translate"),e._UZ(7,"clr-icon",21),e.qZA(),e.TgZ(8,"div",22),e.YNc(9,ke,3,4,"button",23),e.YNc(10,Je,3,3,"button",24),e.TgZ(11,"button",25),e.NdJ("click",function(){const o=e.CHM(l).index,s=e.oxw(2);return e.KtG(s.editRuleByIndex(o))}),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"button",25),e.NdJ("click",function(){const o=e.CHM(l).$implicit,s=e.oxw(2);return e.KtG(s.deleteRule(o.id))}),e._uU(15),e.ALo(16,"translate"),e.qZA()()()(),e.TgZ(17,"div",1)(18,"span"),e.YNc(19,we,1,0,"clr-icon",26),e.YNc(20,Pe,1,1,"clr-icon",27),e.qZA(),e.TgZ(21,"span",28)(22,"span"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"span"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"span"),e._uU(29),e.qZA(),e.TgZ(30,"span"),e._uU(31,","),e.qZA(),e.TgZ(32,"span"),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"span"),e._uU(36),e.ALo(37,"translate"),e.qZA(),e.TgZ(38,"span",29),e._uU(39),e.qZA(),e.YNc(40,De,12,10,"ng-container",30),e.qZA()()()()}if(2&r){const l=i.$implicit,t=i.index,n=e.oxw(2);e.xp6(3),e.Q6J("ngClass",e.VKq(33,Qe,n.ruleIndex===t)),e.xp6(1),e.s9C("id","action"+t),e.xp6(1),e.hij(" ",e.lcZ(6,19,"IMMUTABLE_TAG.ACTION")," "),e.xp6(4),e.Q6J("ngIf",!(null!=l&&l.disabled)),e.xp6(1),e.Q6J("ngIf",null==l?null:l.disabled),e.xp6(1),e.s9C("id","edit-btn"+t),e.xp6(1),e.hij(" ",e.lcZ(13,21,"IMMUTABLE_TAG.EDIT")," "),e.xp6(2),e.s9C("id","delete-btn"+t),e.xp6(1),e.hij(" ",e.lcZ(16,23,"IMMUTABLE_TAG.DELETE")," "),e.xp6(4),e.Q6J("ngIf",!(null!=l&&l.disabled)),e.xp6(1),e.Q6J("ngIf",null==l?null:l.disabled),e.xp6(3),e.Oqu(e.lcZ(24,25,"IMMUTABLE_TAG.IN_REPOSITORIES")),e.xp6(3),e.Oqu(e.lcZ(27,27,n.getI18nKey(null==l||null==l.scope_selectors||null==l.scope_selectors.repository[0]?null:l.scope_selectors.repository[0].decoration))),e.xp6(3),e.Oqu(n.formatPattern(null==l||null==l.scope_selectors||null==l.scope_selectors.repository[0]?null:l.scope_selectors.repository[0].pattern)),e.xp6(4),e.Oqu(e.lcZ(34,29,"IMMUTABLE_TAG.LOWER_TAGS")),e.xp6(3),e.Oqu(e.lcZ(37,31,n.getI18nKey(null==l||null==l.tag_selectors[0]?null:l.tag_selectors[0].decoration))),e.xp6(2),e.s9C("id","tag-selectors-patten"+t),e.xp6(1),e.Oqu(n.formatPattern(null==l||null==l.tag_selectors[0]?null:l.tag_selectors[0].pattern)),e.xp6(1),e.Q6J("ngIf",(null==l||null==l.tag_selectors[1]?null:l.tag_selectors[1].pattern)&&(null==l||null==l.tag_selectors[1]?null:l.tag_selectors[1].pattern))}}function Ye(r,i){if(1&r&&(e.TgZ(0,"ul",15),e.YNc(1,je,41,35,"li",16),e.qZA()),2&r){const l=e.oxw();e.xp6(1),e.Q6J("ngForOf",l.rules)}}function Ke(r,i){if(1&r){const l=e.EpF();e.TgZ(0,"div",35),e.NdJ("click",function(){e.CHM(l);const n=e.oxw();return e.KtG(n.ruleIndex=-1)}),e.qZA()}}const Be=function(r){return{"pt-1":r}};let He=(()=>{var r;class i{constructor(t,n,o,s,h,tt){this.route=t,this.immutableTagService=n,this.immutableService=o,this.retentionService=s,this.errorHandler=h,this.projectService=tt,this.selectedItem=null,this.ruleIndex=-1,this.index=-1,this.rules=[],this.loadingRule=!1}ngOnInit(){this.projectId=+this.route.snapshot.parent.parent.parent.params.id,this.getRules(),this.getMetadata()}getMetadata(){this.retentionService.getRentenitionMetadata().subscribe({next:t=>{this.addRuleComponent.metadata=t},error:t=>{this.errorHandler.error(t)}})}getRules(){this.immutableService.ListImmuRules({projectNameOrId:this.projectId.toString(),pageSize:15}).subscribe({next:t=>{this.rules=t,this.loadingRule=!1},error:t=>{this.errorHandler.error(t),this.loadingRule=!1}})}editRuleByIndex(t){this.editIndex=t,this.addRuleComponent.rule=(0,u.d9)(this.rules[t]),this.addRuleComponent.editRuleOrigin=(0,u.d9)(this.rules[t]),this.addRuleComponent.open(),this.addRuleComponent.isAdd=!1,this.ruleIndex=-1}toggleDisable(t,n){let o=(0,u.d9)(t);o.disabled=n,this.ruleIndex=-1,this.loadingRule=!0,this.immutableService.UpdateImmuRule({immutableRuleId:o.id,projectNameOrId:this.projectId.toString(),ImmutableRule:o}).subscribe({next:s=>{this.getRules()},error:s=>{this.loadingRule=!1,this.errorHandler.error(s)}})}deleteRule(t){this.ruleIndex=-1,this.loadingRule=!0,this.immutableService.DeleteImmuRule({projectNameOrId:this.projectId.toString(),immutableRuleId:t}).subscribe({next:n=>{this.getRules()},error:n=>{this.loadingRule=!1,this.errorHandler.error(n)}})}openAddRule(){this.addRuleComponent.open(),this.addRuleComponent.isAdd=!0,this.addRuleComponent.rule=new b(this.projectId)}openEditor(t){this.ruleIndex=this.ruleIndex!==t?t:-1}refreshAfterCreatRetention(){this.projectService.getProject({projectNameOrId:this.projectId.toString()}).subscribe({next:t=>{this.getRules()},error:t=>{this.loadingRule=!1,this.errorHandler.error(t)}})}clickAdd(t){this.loadingRule=!0,this.addRuleComponent.onGoing=!0,this.addRuleComponent.isAdd?t.id?this.updateRule(t):this.immutableService.CreateImmuRule({projectNameOrId:this.projectId.toString(),ImmutableRule:t}).pipe((0,m.x)(()=>this.addRuleComponent.onGoing=!1)).subscribe({next:n=>{this.refreshAfterCreatRetention(),this.addRuleComponent.close()},error:n=>{n&&n.error&&n.error.message&&(n=this.immutableTagService.getI18nKey(n.error.message)),this.addRuleComponent.inlineAlert.showInlineError(n),this.loadingRule=!1}}):this.updateRule(t)}updateRule(t){this.immutableService.UpdateImmuRule({projectNameOrId:this.projectId.toString(),immutableRuleId:t.id,ImmutableRule:t}).pipe((0,m.x)(()=>this.addRuleComponent.onGoing=!1)).subscribe({next:n=>{this.getRules(),this.addRuleComponent.close()},error:n=>{this.loadingRule=!1,n&&n.error&&n.error.message&&(n=this.immutableTagService.getI18nKey(n.error.message)),this.addRuleComponent.inlineAlert.showInlineError(n)}})}formatPattern(t){let n=t;return/^{\S+}$/.test(n)?n.slice(1,n.length-1):n}getI18nKey(t){return this.immutableTagService.getI18nKey(t)}}return(r=i).\u0275fac=function(t){return new(t||r)(e.Y36(_.gz),e.Y36(O),e.Y36(Oe.j),e.Y36(Z.e),e.Y36(C.q),e.Y36(q.Y))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-immutable-tag"]],viewQuery:function(t,n){if(1&t&&e.Gf(qe,5),2&t){let o;e.iGM(o=e.CRH())&&(n.addRuleComponent=o.first)}},decls:20,vars:16,consts:[[1,"clr-row","pt-1","fw8"],[1,"clr-col"],[1,"label-left","font-style"],[1,"badge","badge-3","ml-5"],["class","spinner spinner-inline ml-2",4,"ngIf"],[1,"clr-row","pt-1"],["class","list-unstyled",4,"ngIf"],[1,"v-center","clr-row",3,"ngClass"],[1,"clr-col-2","flex-150"],[1,"add-rule-btn"],["id","add-rule",1,"btn","btn-primary",3,"disabled","click"],[3,"rules","projectId","clickAdd"],["addRule",""],["class","backdrop-transparent",3,"click",4,"ngIf"],[1,"spinner","spinner-inline","ml-2"],[1,"list-unstyled"],["class","rule",4,"ngFor","ngForOf"],[1,"rule"],[1,"clr-row"],[1,"dropdown",3,"ngClass"],[1,"dropdown-toggle","btn","btn-sm","btn-link",3,"id","click"],["shape","caret down"],[1,"dropdown-menu"],["type","button","class","dropdown-item",3,"id","click",4,"ngIf"],["type","button","class","dropdown-item",3,"click",4,"ngIf"],["type","button",1,"dropdown-item",3,"id","click"],["class","color-green","shape","success-standard",4,"ngIf"],["class","ml-0 color-red","shape","error-standard",3,"id",4,"ngIf"],[1,"rule-name","ml-5"],[3,"id"],[4,"ngIf"],["type","button",1,"dropdown-item",3,"click"],["shape","success-standard",1,"color-green"],["shape","error-standard",1,"ml-0","color-red",3,"id"],[1,"color-97"],[1,"backdrop-transparent",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"span",3),e._uU(6),e.qZA(),e.YNc(7,Ge,2,0,"span",4),e.qZA()(),e.TgZ(8,"div",5)(9,"div",1),e.YNc(10,Ye,2,1,"ul",6),e.TgZ(11,"div",7),e._UZ(12,"div",8),e.TgZ(13,"div",9)(14,"button",10),e.NdJ("click",function(){return n.openAddRule()}),e._uU(15),e.ALo(16,"translate"),e.qZA()()()()(),e.TgZ(17,"app-add-immutable-rule",11,12),e.NdJ("clickAdd",function(s){return n.clickAdd(s)}),e.qZA(),e.YNc(19,Ke,1,0,"div",13)),2&t&&(e.xp6(3),e.Oqu(e.lcZ(4,10,"IMMUTABLE_TAG.IMMUTABLE_RULES")),e.xp6(3),e.hij("",null!=n.rules&&n.rules.length?null==n.rules?null:n.rules.length:0,"/15"),e.xp6(1),e.Q6J("ngIf",n.loadingRule),e.xp6(3),e.Q6J("ngIf",(null==n.rules?null:n.rules.length)>0),e.xp6(1),e.Q6J("ngClass",e.VKq(14,Be,(null==n.rules?null:n.rules.length)>0)),e.xp6(3),e.Q6J("disabled",(null==n.rules?null:n.rules.length)>=15),e.xp6(1),e.hij(" ",e.lcZ(16,12,"IMMUTABLE_TAG.ADD_RULE")," "),e.xp6(2),e.Q6J("rules",n.rules)("projectId",n.projectId),e.xp6(2),e.Q6J("ngIf",-1!==n.ruleIndex))},dependencies:[a.qvL,a.MgK,p.mk,p.sg,p.O5,ye,T.X$],styles:[".ml-5[_ngcontent-%COMP%]{margin-left:5px}.dropdown-toggle[_ngcontent-%COMP%]{outline:none;padding-left:0}.backdrop-transparent[_ngcontent-%COMP%]{position:fixed;inset:0;opacity:0;z-index:999}.v-center[_ngcontent-%COMP%]{height:48px;line-height:48px}.font-size-54[_ngcontent-%COMP%]{font-size:.5417rem}.flex-150[_ngcontent-%COMP%]{flex:0 0 150px}.rule-name[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:.5417rem}.color-97[_ngcontent-%COMP%]{color:#979797}.add-rule-btn[_ngcontent-%COMP%]{min-width:120px;padding-left:12px}"]}),i})();var k=c(4410);function Fe(r,i){if(1&r){const l=e.EpF();e.TgZ(0,"clr-dg-row",5)(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e._uU(4),e.qZA(),e.TgZ(5,"clr-dg-cell"),e._uU(6),e.qZA(),e.TgZ(7,"clr-dg-cell"),e._uU(8),e.ALo(9,"harborDatetime"),e.qZA(),e.TgZ(10,"clr-dg-cell"),e._uU(11),e.qZA(),e.TgZ(12,"clr-dg-cell")(13,"span",6),e.NdJ("click",function(){const o=e.CHM(l).$implicit,s=e.oxw();return e.KtG(s.seeLog(o.execution_id,o.id))}),e._UZ(14,"clr-icon",7),e.qZA()()()}if(2&r){const l=i.$implicit;e.Q6J("clrDgItem",l),e.xp6(2),e.Oqu(l.repository),e.xp6(2),e.Oqu(l.status),e.xp6(2),e.AsE("",null!=l&&l.retained?null==l?null:l.retained:0,"/",null!=l&&l.total?null==l?null:l.total:0,""),e.xp6(2),e.Oqu(e.xi3(9,7,l.start_time,"medium")),e.xp6(3),e.Oqu(l.duration)}}function ze(r,i){if(1&r&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){e.oxw();const l=e.MAs(29);e.xp6(1),e.lnq("",l.firstItem+1," - ",l.lastItem+1," ",e.lcZ(2,3,"ROBOT_ACCOUNT.OF")," ")}}let $e=(()=>{var r;class i{constructor(t,n,o){this.tagRetentionService=t,this.retentionService=n,this.errorHandler=o,this.loading=!0,this.page=1,this.pageSize=5,this.total=0,this.tasks=[]}ngOnDestroy(){this.tasksTimeout&&(clearTimeout(this.tasksTimeout),this.tasksTimeout=null)}loadLog(){this.loading=!0,this.retentionService.listRetentionTasksResponse({id:this.retentionId,eid:this.executionId,page:this.page,pageSize:this.pageSize}).pipe((0,m.x)(()=>this.loading=!1)).subscribe({next:t=>{this.handleResponse(t)},error:t=>{this.errorHandler.error(t)}})}seeLog(t,n){this.tagRetentionService.seeLog(this.retentionId,t,n)}loopGettingTasks(){this.tasks&&this.tasks.length&&this.tasks.some(t=>t.status===U||t.status===v)&&(this.tasksTimeout=setTimeout(()=>{this.retentionService.listRetentionTasksResponse({id:this.retentionId,eid:this.executionId,page:this.page,pageSize:this.pageSize}).pipe((0,m.x)(()=>this.loading=!1)).subscribe(t=>{this.handleResponse(t)})},5e3))}handleResponse(t){if(t.headers){let n=t.headers.get("x-total-count");n&&(this.total=parseInt(n,0))}this.tasks=t.body,E.calculateDuration(this.tasks),this.loopGettingTasks()}}return(r=i).\u0275fac=function(t){return new(t||r)(e.Y36(f),e.Y36(Z.e),e.Y36(C.q))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-tag-retention-tasks"]],inputs:{retentionId:"retentionId",executionId:"executionId"},decls:30,vars:34,consts:[[1,"w-100",3,"clrDgLoading","clrDgRefresh"],[3,"clrDgItem",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"clrDgTotalItems","clrDgPage","clrDgPageSize","clrDgPageChange"],["innerPagination",""],[3,"clrDgItem"],[1,"hand","color-79b",3,"click"],["shape","list"]],template:function(t,n){if(1&t&&(e.TgZ(0,"clr-datagrid",0),e.NdJ("clrDgRefresh",function(){return n.loadLog()}),e.TgZ(1,"clr-dg-column"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"clr-dg-column"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"clr-dg-column"),e._uU(8),e.ALo(9,"translate"),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"clr-dg-column"),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"clr-dg-column"),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"clr-dg-column"),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"clr-dg-placeholder"),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.YNc(23,Fe,15,10,"clr-dg-row",1),e.TgZ(24,"clr-dg-footer"),e.YNc(25,ze,3,5,"span",2),e._uU(26),e.ALo(27,"translate"),e.TgZ(28,"clr-dg-pagination",3,4),e.NdJ("clrDgPageChange",function(s){return n.page=s}),e.qZA()()()),2&t){const o=e.MAs(29);e.Q6J("clrDgLoading",n.loading),e.xp6(2),e.Oqu(e.lcZ(3,16,"TAG_RETENTION.REPOSITORY")),e.xp6(3),e.Oqu(e.lcZ(6,18,"TAG_RETENTION.STATUS")),e.xp6(3),e.AsE("",e.lcZ(9,20,"TAG_RETENTION.RETAINED"),"/",e.lcZ(10,22,"TAG_RETENTION.TOTAL"),""),e.xp6(4),e.Oqu(e.lcZ(13,24,"TAG_RETENTION.START_TIME")),e.xp6(3),e.Oqu(e.lcZ(16,26,"TAG_RETENTION.DURATION")),e.xp6(3),e.Oqu(e.lcZ(19,28,"TAG_RETENTION.LOG")),e.xp6(3),e.hij(" ",e.lcZ(22,30,"TAG_RETENTION.NO_HISTORY")," "),e.xp6(2),e.Q6J("ngForOf",n.tasks),e.xp6(2),e.Q6J("ngIf",o),e.xp6(1),e.AsE(" ",n.total," ",e.lcZ(27,32,"ROBOT_ACCOUNT.ITEMS")," "),e.xp6(2),e.Q6J("clrDgTotalItems",n.total)("clrDgPage",n.page)("clrDgPageSize",n.pageSize)}},dependencies:[a.C9t,a.fv_,a.m4W,a.dRQ,a.Ltv,a.F7K,a.Z4N,a.jND,a.KHL,a.PDs,a.Gcc,a.dml,a.Nh1,a.K8c,a.qvL,p.sg,p.O5,T.X$,k.Z],styles:[".hand[_ngcontent-%COMP%]{cursor:pointer}.color-79b[_ngcontent-%COMP%]{color:#0079b8}"]}),i})();var We=c(7239);let J=(()=>{var r;class i{constructor(t){this.memberPermissionGuard=t}canActivate(t,n){return this.memberPermissionGuard.checkPermission(t.parent.parent.parent.params.id,t.data.permissionParam)}}return(r=i).\u0275fac=function(t){return new(t||r)(e.LFG(We.P))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),i})();var Xe=c(575);const Ve=[{path:"",component:P,children:[{path:"tag-retention",canActivate:[J],data:{permissionParam:{resource:g._W.TAG_RETENTION.KEY,action:g._W.TAG_RETENTION.VALUE.READ}},component:E},{path:"immutable-tag",canActivate:[J],data:{permissionParam:{resource:g._W.IMMUTABLE_TAG.KEY,action:g._W.IMMUTABLE_TAG.VALUE.LIST}},component:He},{path:"",redirectTo:"tag-retention",pathMatch:"full"}]}];let et=(()=>{var r;class i{}return(r=i).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({providers:[f,O],imports:[_.Bz.forChild(Ve),de.m]}),i})();e.B6R(E,function(){return[a.I9z,a.C9t,a.Gwl,a.fv_,a.m4W,a.dRQ,a.YYR,a.Ltv,a.F7K,a.Z4N,a.Nz$,a.jND,a.KHL,a.PDs,a.Gcc,a.dml,a.Nh1,a.K8c,a.qvL,a.qAN,a.VLi,a.DbV,a.MgK,p.mk,p.sg,p.O5,Xe.x,Ee,$e]},function(){return[T.X$,k.Z]})}}]);