"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[8833],{8833:(k,h,i)=>{i.r(h),i.d(h,{ProjectScannerModule:()=>K});var S=i(2787),N=i(4554),r=i(8280),C=i(4716),m=i(2141),A=i(208),u=i(1691),v=i(9315),n=i(5879),x=i(3419),T=i(7655),Z=i(9515),b=i(5738),_=i(6223),E=i(6814);function O(e,c){1&e&&(n.TgZ(0,"div",13),n._UZ(1,"span",14),n.qZA())}function I(e,c){1&e&&(n.TgZ(0,"label",22),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&e&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.SCANNER")))}function q(e,c){if(1&e){const t=n.EpF();n.TgZ(0,"button",23),n.NdJ("click",function(){n.CHM(t);const l=n.oxw(2);return n.KtG(l.open())}),n._uU(1),n.ALo(2,"translate"),n.qZA()}2&e&&(n.xp6(1),n.hij(" ",n.lcZ(2,1,"SCANNER.EDIT")," "))}function L(e,c){1&e&&(n.TgZ(0,"label",24),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&e&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.NOT_AVAILABLE")))}function U(e,c){1&e&&(n.TgZ(0,"label",24),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&e&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.NO_PROJECT_SCANNER")))}function J(e,c){1&e&&(n.TgZ(0,"span",34),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&e&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.DISABLED")))}function M(e,c){1&e&&(n.TgZ(0,"span",35),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&e&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.UNHEALTHY")))}function R(e,c){1&e&&(n.TgZ(0,"span",36),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&e&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.HEALTHY")))}function y(e,c){if(1&e&&(n.TgZ(0,"div",16)(1,"label",31),n._uU(2),n.ALo(3,"translate"),n.qZA(),n.TgZ(4,"div",18)(5,"div",25),n._UZ(6,"input",37),n.qZA()()()),2&e){const t=n.oxw(3);n.xp6(2),n.Oqu(n.lcZ(3,2,"SCANNER.ADAPTER")),n.xp6(4),n.Q6J("ngModel",null==t.scanner?null:t.scanner.adapter)}}function P(e,c){if(1&e&&(n.TgZ(0,"div",16)(1,"label",31),n._uU(2),n.ALo(3,"translate"),n.qZA(),n.TgZ(4,"div",18)(5,"div",25),n._UZ(6,"input",38),n.qZA()()()),2&e){const t=n.oxw(3);n.xp6(2),n.Oqu(n.lcZ(3,2,"SCANNER.VENDOR")),n.xp6(4),n.Q6J("ngModel",null==t.scanner?null:t.scanner.vendor)}}function j(e,c){if(1&e&&(n.TgZ(0,"div",16)(1,"label",31),n._uU(2),n.ALo(3,"translate"),n.qZA(),n.TgZ(4,"div",18)(5,"div",25),n._UZ(6,"input",39),n.qZA()()()),2&e){const t=n.oxw(3);n.xp6(2),n.Oqu(n.lcZ(3,2,"SCANNER.VERSION")),n.xp6(4),n.Q6J("ngModel",null==t.scanner?null:t.scanner.version)}}function Q(e,c){if(1&e&&(n.ynx(0),n.TgZ(1,"div",16)(2,"label",22),n._uU(3),n.ALo(4,"translate"),n.qZA(),n.TgZ(5,"div",18)(6,"div",25)(7,"div",26)(8,"span",27),n._uU(9),n.qZA(),n.YNc(10,J,3,3,"span",28),n.YNc(11,M,3,3,"span",29),n.YNc(12,R,3,3,"span",30),n.qZA()()()(),n.TgZ(13,"div",16)(14,"label",31),n._uU(15),n.ALo(16,"translate"),n.qZA(),n.TgZ(17,"div",18)(18,"div",25),n._UZ(19,"input",32),n.qZA()()(),n.YNc(20,y,7,4,"div",33),n.YNc(21,P,7,4,"div",33),n.YNc(22,j,7,4,"div",33),n.BQk()),2&e){const t=n.oxw(2);n.xp6(3),n.Oqu(n.lcZ(4,10,"SCANNER.NAME")),n.xp6(6),n.Oqu(null==t.scanner?null:t.scanner.name),n.xp6(1),n.Q6J("ngIf",null==t.scanner?null:t.scanner.disabled),n.xp6(1),n.Q6J("ngIf","unhealthy"===(null==t.scanner?null:t.scanner.health)),n.xp6(1),n.Q6J("ngIf","healthy"===(null==t.scanner?null:t.scanner.health)),n.xp6(3),n.Oqu(n.lcZ(16,12,"SCANNER.ENDPOINT")),n.xp6(4),n.Q6J("ngModel",null==t.scanner?null:t.scanner.url),n.xp6(1),n.Q6J("ngIf",null==t.scanner?null:t.scanner.adapter),n.xp6(1),n.Q6J("ngIf",null==t.scanner?null:t.scanner.vendor),n.xp6(1),n.Q6J("ngIf",null==t.scanner?null:t.scanner.version)}}function D(e,c){if(1&e){const t=n.EpF();n.TgZ(0,"button",40),n.NdJ("click",function(){n.CHM(t);const l=n.oxw(2);return n.KtG(l.open())}),n._uU(1),n.ALo(2,"translate"),n.qZA()}2&e&&(n.xp6(1),n.hij(" ",n.lcZ(2,1,"SCANNER.SELECT_SCANNER")," "))}function Y(e,c){if(1&e&&(n.TgZ(0,"div",15)(1,"div",16),n.YNc(2,I,3,3,"label",17),n.TgZ(3,"div",18),n.YNc(4,q,3,3,"button",19),n.YNc(5,L,3,3,"label",20),n.YNc(6,U,3,3,"label",20),n.qZA()(),n.YNc(7,Q,23,14,"ng-container",8),n.YNc(8,D,3,3,"button",21),n.qZA()),2&e){const t=n.oxw();n.xp6(2),n.Q6J("ngIf",!t.scanner),n.xp6(2),n.Q6J("ngIf",!t.scanner&&t.hasCreatePermission&&t.scanners&&t.scanners.length>0),n.xp6(1),n.Q6J("ngIf",!t.scanner&&t.hasCreatePermission&&!(t.scanners&&t.scanners.length>0)),n.xp6(1),n.Q6J("ngIf",!t.scanner&&!t.hasCreatePermission),n.xp6(1),n.Q6J("ngIf",t.scanner),n.xp6(1),n.Q6J("ngIf",t.hasCreatePermission&&t.scanners&&t.scanners.length>0)}}function w(e,c){if(1&e&&(n.TgZ(0,"span",44),n._uU(1),n.qZA()),2&e){const t=n.oxw().$implicit;n.xp6(1),n.Oqu(t.is_default)}}function H(e,c){if(1&e&&(n.TgZ(0,"span",44),n._uU(1),n.qZA()),2&e){const t=n.oxw().$implicit;n.xp6(1),n.Oqu(t.is_default)}}function B(e,c){if(1&e&&(n.TgZ(0,"clr-dg-row",41)(1,"clr-dg-cell"),n._uU(2),n.qZA(),n.TgZ(3,"clr-dg-cell"),n._uU(4),n.qZA(),n.TgZ(5,"clr-dg-cell",42),n.YNc(6,w,2,1,"span",43),n.YNc(7,H,2,1,"span",43),n.qZA(),n.TgZ(8,"clr-dg-cell"),n._uU(9),n.qZA()()),2&e){const t=c.$implicit;n.Q6J("clrDgItem",t),n.xp6(2),n.Oqu(t.name),n.xp6(2),n.Oqu(t.url),n.xp6(2),n.Q6J("ngIf",t.is_default),n.xp6(1),n.Q6J("ngIf",!t.is_default),n.xp6(2),n.Oqu(t.description)}}function z(e,c){if(1&e&&(n.TgZ(0,"span"),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&e){const t=n.oxw();n.xp6(1),n.AsE("1 - ",null==t.scanners?null:t.scanners.length," ",n.lcZ(2,2,"WEBHOOK.OF")," ")}}const F=[{path:"",component:(()=>{var e;class c{constructor(a,l,s,o,p,g){this.msgHandler=a,this.errorHandler=l,this.route=s,this.userPermissionService=o,this.translate=p,this.projectService=g,this.loading=!1,this.opened=!1,this.saveBtnState=r.xp5.DEFAULT,this.onSaving=!1,this.hasCreatePermission=!1}ngOnInit(){this.projectId=+this.route.snapshot.parent.parent.params.id,this.getPermission(),this.init()}getPermission(){this.projectId&&this.userPermissionService.getPermission(this.projectId,m._W.SCANNER.KEY,m._W.SCANNER.VALUE.CREATE).subscribe(a=>{this.hasCreatePermission=a,this.hasCreatePermission&&this.getScanners()})}init(){this.getScanner()}getScanner(a){this.loading=!0,this.projectService.getScannerOfProject({projectNameOrId:this.projectId.toString()}).pipe((0,C.x)(()=>this.loading=!1)).subscribe(l=>{l&&"{}"!==JSON.stringify(l)&&(this.scanner=l,a&&"healthy"!==this.scanner.health&&this.translate.get("SCANNER.SET_UNHEALTHY_SCANNER",{name:this.scanner.name}).subscribe(s=>{this.errorHandler.warning(s)}))},l=>{this.errorHandler.error(l)})}getScanners(){this.projectId&&this.projectService.listScannerCandidatesOfProjectResponse({projectNameOrId:this.projectId.toString(),page:1,pageSize:u.L8}).subscribe(a=>{if(a.headers){const l=a.headers.get("X-Total-Count"),s=parseInt(l,0);let o=a.body||[];if(s<=u.L8)o&&o.length>0&&(this.scanners=o.filter(p=>!p.disabled));else{const p=Math.ceil(s/u.L8),g=[];for(let d=2;d<=p;d++)g.push(this.projectService.listScannerCandidatesOfProject({page:d,pageSize:u.L8,projectNameOrId:this.projectId.toString()}));(0,v.D)(g).subscribe(d=>{d&&d.length&&(d.forEach(f=>{o=o.concat(f)}),this.scanners=o.filter(f=>!f.disabled))})}}})}close(){this.opened=!1,this.selectedScanner=null}open(){this.opened=!0,this.inlineAlert.close(),this.scanners.forEach(a=>{this.scanner&&a.uuid===this.scanner.uuid&&(this.selectedScanner=a)})}get valid(){return this.selectedScanner&&!(this.scanner&&this.scanner.uuid===this.selectedScanner.uuid)}save(){this.saveBtnState=r.xp5.LOADING,this.projectService.setScannerOfProject({projectNameOrId:this.projectId.toString(),payload:{uuid:this.selectedScanner.uuid}}).subscribe(a=>{this.close(),this.msgHandler.showSuccess("Update Success"),this.getScanner(!0),this.saveBtnState=r.xp5.SUCCESS},a=>{this.inlineAlert.showInlineError(a),this.saveBtnState=r.xp5.ERROR})}}return(e=c).\u0275fac=function(a){return new(a||e)(n.Y36(x.d),n.Y36(T.q),n.Y36(S.gz),n.Y36(m.Hx),n.Y36(Z.sK),n.Y36(b.Y))},e.\u0275cmp=n.Xpm({type:e,selectors:[["scanner"]],viewQuery:function(a,l){if(1&a&&n.Gf(A.l,5),2&a){let s;n.iGM(s=n.CRH())&&(l.inlineAlert=s.first)}},decls:34,vars:39,consts:[["class","clr-row mt-2 center",4,"ngIf"],["class","clr-form clr-form-horizontal",4,"ngIf"],[3,"clrModalSize","clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalOpenChange"],[1,"modal-title"],[1,"modal-body","body-format"],[3,"clrDgSingleSelected","clrDgSingleSelectedChange"],[3,"clrDgField"],[3,"clrDgItem",4,"clrDgItems","clrDgItemsOf"],[4,"ngIf"],[3,"clrDgPageSize"],[1,"modal-footer"],["id","cancel","type","button",1,"btn","btn-outline",3,"click"],["id","save-scanner","type","button",1,"btn","btn-primary",3,"clrLoading","disabled","click"],[1,"clr-row","mt-2","center"],[1,"spinner","spinner-md"],[1,"clr-form","clr-form-horizontal"],[1,"clr-form-control"],["class","clr-control-label name",4,"ngIf"],[1,"clr-control-container"],["id","edit-scanner-copy","class","btn btn-primary",3,"click",4,"ngIf"],["class","name",4,"ngIf"],["id","edit-scanner","type","button","class","btn btn-secondary mt-1",3,"click",4,"ngIf"],[1,"clr-control-label","name"],["id","edit-scanner-copy",1,"btn","btn-primary",3,"click"],[1,"name"],[1,"clr-input-wrapper"],[1,"clr-input-wrapper","name"],["id","scanner-name",1,"scanner-name"],["class","label label-warning ml-1",4,"ngIf"],["class","label label-danger ml-1",4,"ngIf"],["class","label label-success ml-1",4,"ngIf"],[1,"clr-control-label"],["readonly","","type","text","id","scanner-endpoint","autocomplete","off",1,"clr-input","width-240",3,"ngModel"],["class","clr-form-control",4,"ngIf"],[1,"label","label-warning","ml-1"],[1,"label","label-danger","ml-1"],[1,"label","label-success","ml-1"],["readonly","","type","text","id","scanner-scanner","autocomplete","off",1,"clr-input","width-240",3,"ngModel"],["readonly","","type","text","id","scanner-vendor","autocomplete","off",1,"clr-input","width-240",3,"ngModel"],["readonly","","type","text","id","scanner-version","autocomplete","off",1,"clr-input","width-240",3,"ngModel"],["id","edit-scanner","type","button",1,"btn","btn-secondary","mt-1",3,"click"],[3,"clrDgItem"],[1,"position-relative"],["class","label label-info",4,"ngIf"],[1,"label","label-info"]],template:function(a,l){1&a&&(n.YNc(0,O,2,0,"div",0),n.YNc(1,Y,9,6,"div",1),n.TgZ(2,"clr-modal",2),n.NdJ("clrModalOpenChange",function(o){return l.opened=o}),n.TgZ(3,"h3",3),n._uU(4),n.ALo(5,"translate"),n.qZA(),n.TgZ(6,"div",4),n._UZ(7,"inline-alert",3),n.TgZ(8,"clr-datagrid",5),n.NdJ("clrDgSingleSelectedChange",function(o){return l.selectedScanner=o}),n.TgZ(9,"clr-dg-column",6),n._uU(10),n.ALo(11,"translate"),n.qZA(),n.TgZ(12,"clr-dg-column",6),n._uU(13),n.ALo(14,"translate"),n.qZA(),n.TgZ(15,"clr-dg-column"),n._uU(16),n.ALo(17,"translate"),n.qZA(),n.TgZ(18,"clr-dg-column"),n._uU(19),n.ALo(20,"translate"),n.qZA(),n.YNc(21,B,10,6,"clr-dg-row",7),n.TgZ(22,"clr-dg-footer"),n.YNc(23,z,3,4,"span",8),n._uU(24),n.ALo(25,"translate"),n._UZ(26,"clr-dg-pagination",9),n.qZA()()(),n.TgZ(27,"div",10)(28,"button",11),n.NdJ("click",function(){return l.close()}),n._uU(29),n.ALo(30,"translate"),n.qZA(),n.TgZ(31,"button",12),n.NdJ("click",function(){return l.save()}),n._uU(32),n.ALo(33,"translate"),n.qZA()()()),2&a&&(n.Q6J("ngIf",l.loading),n.xp6(1),n.Q6J("ngIf",!l.loading),n.xp6(1),n.Q6J("clrModalSize","xl")("clrModalOpen",l.opened)("clrModalStaticBackdrop",!0)("clrModalClosable",!1),n.xp6(2),n.Oqu(n.lcZ(5,23,"SCANNER.SELECT_SCANNER")),n.xp6(4),n.Q6J("clrDgSingleSelected",l.selectedScanner),n.xp6(1),n.Q6J("clrDgField","name"),n.xp6(1),n.Oqu(n.lcZ(11,25,"SCANNER.NAME")),n.xp6(2),n.Q6J("clrDgField","url"),n.xp6(1),n.Oqu(n.lcZ(14,27,"SCANNER.ENDPOINT")),n.xp6(3),n.Oqu(n.lcZ(17,29,"SCANNER.DEFAULT")),n.xp6(3),n.Oqu(n.lcZ(20,31,"SCANNER.DESCRIPTION")),n.xp6(2),n.Q6J("clrDgItemsOf",l.scanners),n.xp6(2),n.Q6J("ngIf",(null==l.scanners?null:l.scanners.length)>0),n.xp6(1),n.AsE(" ",null==l.scanners?null:l.scanners.length," ",n.lcZ(25,33,"WEBHOOK.ITEMS")," "),n.xp6(2),n.Q6J("clrDgPageSize",10),n.xp6(3),n.hij(" ",n.lcZ(30,35,"BUTTON.CANCEL")," "),n.xp6(2),n.Q6J("clrLoading",l.saveBtnState)("disabled",!l.valid),n.xp6(1),n.hij(" ",n.lcZ(33,37,"BUTTON.OK")," "))},dependencies:[_.Fj,_.JJ,_.On,r.C9t,r.fv_,r.m4W,r.dRQ,r.f6,r.Ltv,r.Z4N,r.jND,r.KHL,r.PDs,r.Gcc,r.dml,r.Nh1,r.K8c,r.qAN,r.VLi,r.cCV,r.MPb,r.MgK,E.O5,A.l,Z.X$],styles:[".scanner-name[_ngcontent-%COMP%]{height:1rem;display:inline-block;padding:0 .25rem;max-height:1rem;font-size:.5417rem}.edit[_ngcontent-%COMP%]{margin-top:-5px;margin-left:-8px;font-size:.58rem}.width-240[_ngcontent-%COMP%]{width:240px}.center[_ngcontent-%COMP%]{justify-content:center;align-items:center}.clr-form-control[_ngcontent-%COMP%]{margin-top:.75rem!important}.name[_ngcontent-%COMP%]{height:1.75rem;line-height:1.75rem}"]}),c})()}];let K=(()=>{var e;class c{}return(e=c).\u0275fac=function(a){return new(a||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[S.Bz.forChild(F),N.m]}),c})()}}]);